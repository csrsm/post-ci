(window.webpackJsonp=window.webpackJsonp||[]).push([[28],{532:function(t,s,r){"use strict";r.r(s);var _=r(5),v=Object(_.a)({},(function(){var t=this,s=t.$createElement,r=t._self._c||s;return r("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[r("h1",{attrs:{id:"线上问题事故分析"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#线上问题事故分析"}},[t._v("#")]),t._v(" 线上问题事故分析")]),t._v(" "),r("h2",{attrs:{id:"背景"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#背景"}},[t._v("#")]),t._v(" 背景")]),t._v(" "),r("p",[t._v("3月31日下午部分经销商反应dms系统页面出现卡顿问题，根据反映情况，可以确认是clue-service服务接口调用响应超时，经排查发现，具体出现问题的时间节点是31日下午2点整左右。")]),t._v(" "),r("h2",{attrs:{id:"_1-全局服务监控分析"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_1-全局服务监控分析"}},[t._v("#")]),t._v(" "),r("strong",[t._v("1.全局服务监控分析")])]),t._v(" "),r("p",[t._v("通过应用监控TSF发现，clue-service服务的整体并发情况的没有明显的提升，但是服务的平均响应耗时以及错误率却有明显的提升，故排除掉并发量增加导致的系统卡顿的情况。可以发现在14:00左右时，响应耗时骤升导致错误率上升。具体情况如下：")]),t._v(" "),r("table",[r("thead",[r("tr",[r("th",[r("strong",[t._v("13:50 至 13:57")])]),t._v(" "),r("th",[r("strong",[t._v("13:57 至 14:03")])])])]),t._v(" "),r("tbody",[r("tr",[r("td",[t._v("请求量：35113次")]),t._v(" "),r("td",[t._v("请求量：31162次")])]),t._v(" "),r("tr",[r("td",[t._v("吞吐量：73.15qps")]),t._v(" "),r("td",[t._v("吞吐量：74.2qps")])]),t._v(" "),r("tr",[r("td",[t._v("平均响应耗时：225ms")]),t._v(" "),r("td",[t._v("平均响应耗时：2420ms")])]),t._v(" "),r("tr",[r("td",[r("img",{attrs:{src:t.$withBase("/img/issue/问题排查1.png")}})]),t._v(" "),r("td",[r("img",{attrs:{src:t.$withBase("/img/issue/问题排查2.png")}})])]),t._v(" "),r("tr",[r("td",[r("img",{attrs:{src:t.$withBase("/img/issue/问题排查3.png")}})]),t._v(" "),r("td",[r("img",{attrs:{src:t.$withBase("/img/issue/问题排查4.png")}})])]),t._v(" "),r("tr",[r("td",[r("img",{attrs:{src:t.$withBase("/img/issue/问题排查5.png")}})]),t._v(" "),r("td",[r("img",{attrs:{src:t.$withBase("/img/issue/问题排查6.png")}})])])])]),t._v(" "),r("h2",{attrs:{id:"_2-拓扑分析"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_2-拓扑分析"}},[t._v("#")]),t._v(" "),r("strong",[t._v("2.拓扑分析")])]),t._v(" "),r("p",[t._v("通过调用关系分析发现，在下游调用服务中，存储服务如mysql、redis服务的平均响应时间并没有明显的提升，而f4push、yxywzt-lead-center.faw.cn以及dmscloud.faw.cn服务的响应时间具有明显的增长，具体对比如下：")]),t._v(" "),r("table",[r("thead",[r("tr",[r("th",[r("strong",[t._v("13:50 至 13:57")])]),t._v(" "),r("th",[r("strong",[t._v("13:57 至 14:03")])])])]),t._v(" "),r("tbody",[r("tr",[r("td",[r("img",{attrs:{src:t.$withBase("/img/issue/问题排查7.png")}})]),t._v(" "),r("td",[r("img",{attrs:{src:t.$withBase("/img/issue/问题排查8.png")}})])])])]),t._v(" "),r("p",[t._v("具体查看这三个服务的接口调用，通过对比发现三个服务的接口调用数量较少，不会导致整个服务的响应时间以及错误率骤升，故排除下游服务调用问题。具体如下：")]),t._v(" "),r("table",[r("thead",[r("tr",[r("th",[r("strong",[t._v("13:50 至 13:57")])]),t._v(" "),r("th",[r("strong",[t._v("13:57 至 14:03")])])])]),t._v(" "),r("tbody",[r("tr",[r("td",[t._v("f4push")]),t._v(" "),r("td")]),t._v(" "),r("tr",[r("td",[r("img",{attrs:{src:t.$withBase("/img/issue/问题排查9.png")}})]),t._v(" "),r("td",[r("img",{attrs:{src:t.$withBase("/img/issue/问题排查10.png")}})])]),t._v(" "),r("tr",[r("td",[t._v("yxywzt-lead-center.faw.cn")]),t._v(" "),r("td")]),t._v(" "),r("tr",[r("td",[r("img",{attrs:{src:t.$withBase("/img/issue/问题排查11.png")}})]),t._v(" "),r("td",[r("img",{attrs:{src:t.$withBase("/img/issue/问题排查12.png")}})])]),t._v(" "),r("tr",[r("td",[t._v("dmscloud.faw.cn")]),t._v(" "),r("td")]),t._v(" "),r("tr",[r("td",[r("img",{attrs:{src:t.$withBase("/img/issue/问题排查13.png")}})]),t._v(" "),r("td",[r("img",{attrs:{src:t.$withBase("/img/issue/问题排查14.png")}})])])])]),t._v(" "),r("p",[t._v("对比调用mysql、redis的调用情况，发现mysql的请求量并没有太大的变化，而其中慢sql查询的响应时间也没有明显的变化，故排除由于mysql查询导致的系统卡顿的情况。而redis的请求量和响应时间也没有明显的变化，所有可以排除由于redis查询导致的系统卡顿的情况。")]),t._v(" "),r("table",[r("thead",[r("tr",[r("th",[r("strong",[t._v("13:50 至 13:57")])]),t._v(" "),r("th",[r("strong",[t._v("13:57 至 14:03")])])])]),t._v(" "),r("tbody",[r("tr",[r("td",[t._v("mysql")]),t._v(" "),r("td")]),t._v(" "),r("tr",[r("td",[r("img",{attrs:{src:t.$withBase("/img/issue/问题排查15.png")}})]),t._v(" "),r("td",[r("img",{attrs:{src:t.$withBase("/img/issue/问题排查16.png")}})])]),t._v(" "),r("tr",[r("td",[t._v("redis")]),t._v(" "),r("td")]),t._v(" "),r("tr",[r("td",[r("img",{attrs:{src:t.$withBase("/img/issue/问题排查17.png")}})]),t._v(" "),r("td",[r("img",{attrs:{src:t.$withBase("/img/issue/问题排查18.png")}})])])])]),t._v(" "),r("h2",{attrs:{id:"_3-服务实例问题排查"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-服务实例问题排查"}},[t._v("#")]),t._v(" "),r("strong",[t._v("3.服务实例问题排查")])]),t._v(" "),r("p",[t._v("通过排查clue-service服务在13:50-13:57与13:57-14:03两个时间段的对比发现，此服务的其中一个实例（clue-service-79d677cdb6-2t5mc）在请求量下降的情况下，响应时间由1028毫秒骤升至25436毫秒，具体对比如下图：")]),t._v(" "),r("table",[r("thead",[r("tr",[r("th",[r("strong",[t._v("13:50 至 13:57")])]),t._v(" "),r("th",[r("strong",[t._v("13:57 至 14:03")])])])]),t._v(" "),r("tbody",[r("tr",[r("td",[r("img",{attrs:{src:t.$withBase("/img/issue/问题排查19.png")}})]),t._v(" "),r("td",[r("img",{attrs:{src:t.$withBase("/img/issue/问题排查20.png")}})])]),t._v(" "),r("tr",[r("td",[r("img",{attrs:{src:t.$withBase("/img/issue/问题排查21.png")}})]),t._v(" "),r("td",[r("img",{attrs:{src:t.$withBase("/img/issue/问题排查22.png")}})])])])]),t._v(" "),r("p",[t._v("通过查看其他时间段的实例对比，发现此实例的平均响应时间远高于其他实例（平均10倍左右）。故推测反馈问题的经销商请求可能是由当前实例处理，从而导致页面卡顿，影响用户体验。")]),t._v(" "),r("p",[t._v("在确定是此实例导致的系统卡顿问题后，发现TSF监控不能查看节点的内存及cpu的使用情况，而K8s事件监控只能查看近一小时的日志，所以没有办法进行进一步的排查。")]),t._v(" "),r("img",{attrs:{src:t.$withBase("/img/issue/问题排查23.png")}}),t._v(" "),r("h2",{attrs:{id:"_4-结论及建议"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_4-结论及建议"}},[t._v("#")]),t._v(" "),r("strong",[t._v("4.结论及建议")])]),t._v(" "),r("h3",{attrs:{id:"结论"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#结论"}},[t._v("#")]),t._v(" "),r("strong",[t._v("结论：")])]),t._v(" "),r("p",[t._v("clue-service的其中一个实例出现问题，但由于TSF没有采集实例的内存、cpu使用情况以及k8s时间监控不支持历史查询，所以无法进一步排查问题。")]),t._v(" "),r("h3",{attrs:{id:"建议"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#建议"}},[t._v("#")]),t._v(" "),r("strong",[t._v("建议：")])]),t._v(" "),r("p",[t._v("建议将停用此实例并备份，重新创建一个实例，并与此实例不在同一个物理机上，进一步对比观察。")]),t._v(" "),r("h2",{attrs:{id:"_5-总结"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_5-总结"}},[t._v("#")]),t._v(" 5.总结")]),t._v(" "),r("p",[t._v("排查思路")]),t._v(" "),r("ul",[r("li",[t._v("整体服务监控，排查出现问题的时间节点，是否有功能上线，排除新功能上线影响系统")]),t._v(" "),r("li",[t._v("整体服务监控发现的问题时间节点前后TPS是否骤升，判断是否是由于并发导致的问题")]),t._v(" "),r("li",[t._v("查看拓扑关系，检查问题节点时间前后的上下游调用是否存在差异，包括下游应用服务以及下游存储服务\n"),r("ul",[r("li",[t._v("如果下游存储服务的rt大幅度增加（平均响应时间），查看数据库监控，是否存在慢sql、死锁等情况，涉及的表是否是频繁调用的接口中所使用的数据表，此种情况需要优化sql以及业务逻辑")]),t._v(" "),r("li",[t._v("如果下游应用服务的rt大幅度增加，则需要进一步排查下游应用是否有新功能上线导致的问题")])])]),t._v(" "),r("li",[t._v("排查服务实例是否存在问题，服务实例存在问题则需要具体查看实例的虚拟机内存、cpu、jvm等方面确定问题原因")])])])}),[],!1,null,null,null);s.default=v.exports}}]);