(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{492:function(s,a,t){"use strict";t.r(a);var e=t(5),r=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("p",[s._v("修改阿里云服务器ssh端口")]),s._v(" "),t("h1",{attrs:{id:"修改阿里云服务器ssh端口"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#修改阿里云服务器ssh端口"}},[s._v("#")]),s._v(" 修改阿里云服务器ssh端口")]),s._v(" "),t("p",[s._v("今天发现有人对我的阿里云服务器进行了攻击,虽然自己使用了强密码 但感觉还是有点不放心,决定限制只能通过密钥访问,并更换ssh连接端口")]),s._v(" "),t("h2",{attrs:{id:"_1-生成密钥对"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-生成密钥对"}},[s._v("#")]),s._v(" 1.生成密钥对")]),s._v(" "),t("p",[s._v("首先是正常登陆 在服务器上制作密钥对,执行以下命令")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('ssh-keygen -t rsa -C "xxxxx@xxxxx.com"     <==后面填写的是邮箱\n')])])]),t("p",[s._v("首先提示的是密钥保存路径，此处可以直接Enter(默认/root/.ssh/文件下)。第二步和第三步是提示输入密钥锁码，我也直接Enter留空（当然为了私钥安全也可以输入密码）。\n这样密钥对就生成成功了")]),s._v(" "),t("div",{staticClass:"language-查看公钥 extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("Your identification has been saved in /root/.ssh/id_rsa. <== 私钥\nYour public key has been saved in /root/.ssh/id_rsa.pub. <== 公钥\n")])])]),t("p",[s._v("查看公钥")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("cat ~/.ssh/id_rsa.pub\n")])])]),t("h2",{attrs:{id:"_2-在服务器上安装公钥"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-在服务器上安装公钥"}},[s._v("#")]),s._v(" 2.在服务器上安装公钥")]),s._v(" "),t("p",[s._v("这一步操作在~/.ssh目录下操，作为了确保执行成功 先执行上面两个命令,设置文件权限。")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("chmod 600 authorized_keys\nchmod 700 ~/.ssh\ncat id_rsa.pub >> authorized_keys     <== 安装公钥\n")])])]),t("h2",{attrs:{id:"_3-编辑-etc-ssh-sshd-config-文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-编辑-etc-ssh-sshd-config-文件"}},[s._v("#")]),s._v(" 3.编辑 /etc/ssh/sshd_config 文件")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("RSAAuthentication yes\nPubkeyAuthentication yes\nPermitRootLogin yes   <==root能否通过ssh登录\n")])])]),t("p",[s._v("重启ssh服务")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("systemctl restart sshd.service\n")])])]),t("h2",{attrs:{id:"_4-下载私钥文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-下载私钥文件"}},[s._v("#")]),s._v(" 4.下载私钥文件")]),s._v(" "),t("p",[s._v("将私钥文件 id_rsa 通过FTP等方式下载到本地机器上,测试密钥登录是否成功,推荐使用Xshell。 登录成功后回到sshd_config文件，设置禁用密码登陆！")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("PasswordAuthentication no\n")])])]),t("p",[s._v("小心保管好私钥文件，这将是你连接服务器的唯一凭据！")]),s._v(" "),t("h2",{attrs:{id:"_5-修改ssh端口"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-修改ssh端口"}},[s._v("#")]),s._v(" 5.修改SSH端口")]),s._v(" "),t("p",[s._v("还是修改 /etc/ssh/sshd_config，找到Port 22，为稳妥起见，我们先是使用多个端口连接，比如在Port 22在下面添加一行：Port 25，就增加了一个新的连接端口25 重启SSH服务后测试ssh连接：")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("systemctl restart sshd.service          <==重启SSH服务\nssh localhost -p 你的端口号    <==本机上测试ssh连接\n")])])]),t("p",[s._v("centOS7防火墙默认关闭")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("// 查看已开启的端口\nfirewall-cmd --list-ports\n// 查看防火墙状态\nfirewall-cmd --state\n// 开启防火墙\nsystemctl start firewalld\n// 开启端口\nfirewall-cmd --zone=public --add-port=8888/tcp --permanent\n// 删除端口\nfirewall-cmd --zone=public --remove-port=8888/tcp --permanent\n// 重启防火墙\nfirewall-cmd --reload\n")])])]),t("p",[s._v("此处可以使用semanage工具管理对端口、消息接口和网络接口等 配置")]),s._v(" "),t("p",[s._v("安装命令如下：")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("yum install semanage\n\n// 如果提示No package semanage available.\n// 执行如下命令：\nyum provides semanage \n\nyum -y install policycoreutils-python.x86_64\n")])])]),t("p",[s._v("配置ssh端口命令如下")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("// 查看ssh端口\nsemanage port -l|grep ssh\n// 增加ssh端口\nsemanage port -a -t ssh_port_t -p tcp 8888\n")])])]),t("h2",{attrs:{id:"_6-修改阿里云安全策略"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-修改阿里云安全策略"}},[s._v("#")]),s._v(" 6.修改阿里云安全策略")]),s._v(" "),t("p",[s._v("在控制台处，修改防火墙策略，自定义TCP连接端口。")]),s._v(" "),t("h2",{attrs:{id:"_7-阿里云相关配置记录"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_7-阿里云相关配置记录"}},[s._v("#")]),s._v(" 7.阿里云相关配置记录")]),s._v(" "),t("p",[s._v("注意：轻量服务器只能通过私钥连接，密码登陆已关闭，ssh端口为2451")]),s._v(" "),t("h3",{attrs:{id:"_1-mysql"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-mysql"}},[s._v("#")]),s._v(" （1）mysql")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("用户名密码：root/ cuiming@123")])]),s._v(" "),t("li",[t("p",[s._v("远程连接密码：Cuiming@123")])]),s._v(" "),t("li",[t("p",[s._v("端口：3323")])]),s._v(" "),t("li",[t("p",[s._v("允许所有人远程连接mysql")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("– 允许所有远程连接到root权限下的所有数据库\ngrant all privileges on *.* to root@\"%\" identified by '数据库密码';\n– 刷新(必要执行的语句)\nflush privileges;\n")])])]),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('修改mysql root用户密码步骤：\n1.vim /etc/my.cnf   #find / -name "my.cnf"\n2.找到该文件中的[mysqld]，在下面插入一行：skip-grant-tables  #跳过密码登陆\n3.重启mysql服务器 service mysqld restart\n4.mysql –uroot –p 回车键\n5.mysql > use mysql  \n  mysql > UPDATE user SET password = password(‘新密码’) WHERE User = ‘root’;\n6.mysql> flush privileges\n7.vim /etc/my.cnf 删除skip-grant-tables\n8.重启mysql服务器 service mysqld restart\n')])])])])])])}),[],!1,null,null,null);a.default=r.exports}}]);