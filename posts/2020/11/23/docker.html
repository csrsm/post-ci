<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Docker常用命令 | Csrsm</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/csrsm-blog/favicon.ico">
    <meta name="description" content="This is my blog">
    <link rel="preload" href="/csrsm-blog/assets/css/0.styles.0012e2a3.css" as="style"><link rel="preload" href="/csrsm-blog/assets/js/app.acc1d91f.js" as="script"><link rel="preload" href="/csrsm-blog/assets/js/7.8eaaf042.js" as="script"><link rel="preload" href="/csrsm-blog/assets/js/18.e106ea76.js" as="script"><link rel="prefetch" href="/csrsm-blog/assets/js/1.2e718cca.js"><link rel="prefetch" href="/csrsm-blog/assets/js/10.503da5e1.js"><link rel="prefetch" href="/csrsm-blog/assets/js/11.9d2fdfae.js"><link rel="prefetch" href="/csrsm-blog/assets/js/12.fcb21a1d.js"><link rel="prefetch" href="/csrsm-blog/assets/js/13.96503fd7.js"><link rel="prefetch" href="/csrsm-blog/assets/js/14.20d93468.js"><link rel="prefetch" href="/csrsm-blog/assets/js/15.64bd5037.js"><link rel="prefetch" href="/csrsm-blog/assets/js/16.b9a58e29.js"><link rel="prefetch" href="/csrsm-blog/assets/js/17.d4868fcd.js"><link rel="prefetch" href="/csrsm-blog/assets/js/19.ebf1a903.js"><link rel="prefetch" href="/csrsm-blog/assets/js/20.0e2eae33.js"><link rel="prefetch" href="/csrsm-blog/assets/js/21.4752cac2.js"><link rel="prefetch" href="/csrsm-blog/assets/js/22.0a18be31.js"><link rel="prefetch" href="/csrsm-blog/assets/js/23.000382ea.js"><link rel="prefetch" href="/csrsm-blog/assets/js/24.db68ac55.js"><link rel="prefetch" href="/csrsm-blog/assets/js/25.431855c5.js"><link rel="prefetch" href="/csrsm-blog/assets/js/26.dd3da43c.js"><link rel="prefetch" href="/csrsm-blog/assets/js/27.64c1a036.js"><link rel="prefetch" href="/csrsm-blog/assets/js/28.87cb6b0a.js"><link rel="prefetch" href="/csrsm-blog/assets/js/29.a985dc98.js"><link rel="prefetch" href="/csrsm-blog/assets/js/3.ff189134.js"><link rel="prefetch" href="/csrsm-blog/assets/js/30.1ebe5aff.js"><link rel="prefetch" href="/csrsm-blog/assets/js/31.b371235e.js"><link rel="prefetch" href="/csrsm-blog/assets/js/32.a1231124.js"><link rel="prefetch" href="/csrsm-blog/assets/js/33.d558d933.js"><link rel="prefetch" href="/csrsm-blog/assets/js/34.d7d644b4.js"><link rel="prefetch" href="/csrsm-blog/assets/js/35.eb22c3ab.js"><link rel="prefetch" href="/csrsm-blog/assets/js/36.bed5cd89.js"><link rel="prefetch" href="/csrsm-blog/assets/js/37.f8911c28.js"><link rel="prefetch" href="/csrsm-blog/assets/js/38.1ff48400.js"><link rel="prefetch" href="/csrsm-blog/assets/js/39.c6f256ac.js"><link rel="prefetch" href="/csrsm-blog/assets/js/4.326ff035.js"><link rel="prefetch" href="/csrsm-blog/assets/js/40.55598602.js"><link rel="prefetch" href="/csrsm-blog/assets/js/41.41fb4af9.js"><link rel="prefetch" href="/csrsm-blog/assets/js/42.9fd7723b.js"><link rel="prefetch" href="/csrsm-blog/assets/js/43.88e37717.js"><link rel="prefetch" href="/csrsm-blog/assets/js/44.2a443682.js"><link rel="prefetch" href="/csrsm-blog/assets/js/45.377399cb.js"><link rel="prefetch" href="/csrsm-blog/assets/js/46.a5414bf6.js"><link rel="prefetch" href="/csrsm-blog/assets/js/47.a43294de.js"><link rel="prefetch" href="/csrsm-blog/assets/js/48.8742461a.js"><link rel="prefetch" href="/csrsm-blog/assets/js/49.b778b074.js"><link rel="prefetch" href="/csrsm-blog/assets/js/5.f96cd824.js"><link rel="prefetch" href="/csrsm-blog/assets/js/50.186a336f.js"><link rel="prefetch" href="/csrsm-blog/assets/js/6.562b2ef1.js"><link rel="prefetch" href="/csrsm-blog/assets/js/8.40f58b51.js"><link rel="prefetch" href="/csrsm-blog/assets/js/9.c8fcfbba.js">
    <link rel="stylesheet" href="/csrsm-blog/assets/css/0.styles.0012e2a3.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="vuepress-theme-meteorlxy"><header class="header" style="background-size:cover;background-repeat:no-repeat;background-position:center;background-attachment:scroll;background-image:url(http://img.icoisini.xyz/background.jpg);" data-v-7a046aea><div data-v-e4145d0a data-v-7a046aea><nav class="navbar" data-v-e4145d0a><div class="container" data-v-e4145d0a><a href="/csrsm-blog/" class="router-link-active" data-v-e4145d0a><span class="navbar-site-name" data-v-e4145d0a>
          Csrsm
        </span></a> <div class="navbar-toggler" data-v-e4145d0a><svg class="icon" style="font-size:1.2em;" data-v-e4145d0a data-v-e4145d0a><title data-v-e4145d0a data-v-e4145d0a>menu</title><use xlink:href="#icon-menu" data-v-e4145d0a data-v-e4145d0a></use></svg></div> <div class="navbar-links" data-v-e4145d0a><a href="/csrsm-blog/" class="navbar-link" data-v-e4145d0a>
            首页
          </a><a href="/csrsm-blog/posts/" class="navbar-link router-link-active" data-v-e4145d0a>
            Csrsm
          </a></div></div></nav> <div class="navbar-holder" style="display:none;" data-v-e4145d0a></div></div> <div class="banner" data-v-98d6aa8c data-v-7a046aea data-v-7a046aea><div class="container" data-v-98d6aa8c><div class="center" data-v-98d6aa8c><h1 data-v-98d6aa8c data-v-7a046aea>
          Docker常用命令
        </h1></div></div></div></header> <div class="container clearfix show-aside" data-v-4dd605a1 data-v-4dd605a1><main class="main" data-v-4dd605a1><div class="post" data-v-4dd605a1 data-v-4dd605a1><section class="post-meta main-div" data-v-4e23451f><section class="post-date clearfix" data-v-4e23451f><span class="create-date" data-v-4e23451f>
      发布时间 : 2020-11-23
    </span> <span class="update-date" data-v-4e23451f>
      最后修改 : 2022-12-07
    </span></section> <section class="post-links" data-v-4e23451f><a href="/csrsm-blog/posts/2020/11/23/http.html" class="post-link" data-v-4e23451f>
      上一篇 : http简介
    </a> <a href="/csrsm-blog/posts/2021/01/21/change-datasource.html" class="post-link" data-v-4e23451f>
      下一篇 : Mybatis多数据源切换
    </a></section></section> <article class="main-div"><div class="post-content content content__default"><p><img src="https://ss0.bdstatic.com/70cFvHSh_Q1YnxGkpoWK1HF6hhy/it/u=1884518406,3782778982&amp;fm=26&amp;gp=0.jpg" alt="img"></p> <p><img src="https://timgsa.baidu.com/timg?image&amp;quality=80&amp;size=b9999_10000&amp;sec=1607450905867&amp;di=6d5ceb067597312ed726cbaf6d72e5aa&amp;imgtype=0&amp;src=http%3A%2F%2Fimages.linoxide.com%2Fdocker-commands-cheatsheet-part2-700x900.png" alt="img"></p> <h3 id="安装docker"><a href="#安装docker" class="header-anchor">#</a> 安装Docker</h3> <hr> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># 1、卸载老版本</span>
 yum remove <span class="token function">docker</span> <span class="token punctuation">\</span>
                  docker-client <span class="token punctuation">\</span>
                  docker-client-latest <span class="token punctuation">\</span>
                  docker-common <span class="token punctuation">\</span>
                  docker-latest <span class="token punctuation">\</span>
                  docker-latest-logrotate <span class="token punctuation">\</span>
                  docker-logrotate <span class="token punctuation">\</span>
                  docker-engine
<span class="token comment"># 2、更新yum-utils</span>
 yum <span class="token function">install</span> -y yum-utils 
<span class="token comment"># 3、设置镜像仓库--使用阿里云镜像</span>
yum-config-manager <span class="token punctuation">\</span>
    --add-repo <span class="token punctuation">\</span>
    http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo
<span class="token comment"># 4、更新yum</span>
 yum makecache fast
<span class="token comment"># 5、安装docker   docker-ce  ce是社区版  ee是企业版 推荐使用ce版本</span>
yum <span class="token function">install</span> docker-ce docker-ce-cli containerd.io
<span class="token comment"># 6、启动docker</span>
systemctl start <span class="token function">docker</span>
<span class="token comment"># 7、使用命令docker version查看docker是否安装成功</span>
<span class="token function">docker</span> version
<span class="token comment"># 8、测试hello-word镜像</span>
<span class="token function">docker</span> run hello-world
<span class="token comment"># 9、配置阿里云镜像加速</span>
centos配置：
<span class="token function">sudo</span> <span class="token function">mkdir</span> -p /etc/docker
<span class="token function">sudo</span> <span class="token function">tee</span> /etc/docker/daemon.json <span class="token operator">&lt;&lt;-</span><span class="token string">'EOF'
{
  &quot;registry-mirrors&quot;: [&quot;https://2vd8an7e.mirror.aliyuncs.com&quot;]
}
EOF</span>
<span class="token function">sudo</span> systemctl daemon-reload
<span class="token function">sudo</span> systemctl restart <span class="token function">docker</span>
</code></pre></div><h3 id="docker常用命令"><a href="#docker常用命令" class="header-anchor">#</a> Docker常用命令</h3> <hr> <p>帮助命令</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># 查看docker版本信息</span>
<span class="token function">docker</span> version
<span class="token function">docker</span> info
<span class="token function">docker</span> <span class="token punctuation">[</span>command<span class="token punctuation">]</span> --help 万能命令
</code></pre></div><p>官网api：https://docs.docker.com/engine/reference/commandline</p> <h3 id="镜像命令"><a href="#镜像命令" class="header-anchor">#</a> 镜像命令</h3> <p><strong>docker images</strong>  # 查看所有镜像</p> <div class="language-shell extra-class"><pre class="language-shell"><code>可选参数
-a 列出所有镜像 
-q 只显示镜像id
</code></pre></div><p><strong>docker search</strong>   #镜像搜索</p> <div class="language-shell extra-class"><pre class="language-shell"><code>可选参数
--filter 条件过来
例如 <span class="token function">docker</span> search mysql --filter<span class="token operator">=</span>stars<span class="token operator">=</span><span class="token number">3000</span> 搜索stars3000以上的
</code></pre></div><p><strong>docker pull</strong>  #下载镜像</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">docker</span> pull 镜像
<span class="token function">docker</span> pull 镜像:tag
</code></pre></div><p>**docker rmi  -f **#删除镜像</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">docker</span> rmi -f <span class="token variable"><span class="token variable">$(</span><span class="token function">docker</span> images -aq<span class="token variable">)</span></span> 删除全部容器
</code></pre></div><p><strong>设置镜像标签</strong></p> <div class="language-shell extra-class"><pre class="language-shell"><code> <span class="token function">docker</span> tag 860c279d2fec runoob/centos:dev
</code></pre></div><p><strong>创建镜像</strong></p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">docker</span> build dockerfile  <span class="token comment">#通过dockerfile 生产一个镜像</span>
<span class="token function">docker</span> commit            <span class="token comment">#将容器转化成镜像，类似快照</span>
</code></pre></div><p><strong>查看镜像够建过程</strong></p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">docker</span> <span class="token function">history</span> 镜像id     <span class="token comment">#查看镜像够建过程</span>
</code></pre></div><p><strong>启动所有容器</strong></p> <div class="language-text extra-class"><pre class="language-text"><code>docker start $(docker ps -a | awk '{ print $1}' | tail -n +2)
</code></pre></div><p><strong>关闭所有容器</strong></p> <div class="language-text extra-class"><pre class="language-text"><code>docker stop $(docker ps -a | awk '{ print $1}' | tail -n +2)
</code></pre></div><p><strong>删除所有容器</strong></p> <div class="language-text extra-class"><pre class="language-text"><code>docker rm $(docker ps -a | awk '{ print $1}' | tail -n +2)
</code></pre></div><p><strong>删除所有镜像（慎用）</strong></p> <div class="language-text extra-class"><pre class="language-text"><code>docker rmi $(docker images | awk '{print $3}' |tail -n +2)
</code></pre></div><h3 id="容器命令"><a href="#容器命令" class="header-anchor">#</a> 容器命令</h3> <p>有了镜像才可以创建镜像。</p> <p><strong>创建容器</strong></p> <div class="language-shell extra-class"><pre class="language-shell"><code>
<span class="token function">docker</span> run <span class="token punctuation">[</span>可选参数<span class="token punctuation">]</span> imagesName/imagesId
可选项
--name name       <span class="token comment">#给容器起名字</span>
-d                <span class="token comment">#后台启动方式 前提是必须有一个前台进程，否则容器就停止了 </span>
-it               <span class="token comment">#使用交互方式启动 后面跟/bin/bash</span>
-P                <span class="token comment">#随机指定端口映射</span>
-p                <span class="token comment">#指定容器端口 -p 8080(主机端口):8080(容器端口)</span>
-v                <span class="token comment">#容器卷，用来容器内和主机间文件同步用</span>
-c                <span class="token comment">#传入要执行的命令 -c &quot;while true; do echo hello world; sleep 1; done&quot;</span>
--net             <span class="token comment">#指定网络</span>
<span class="token function">docker</span> create  <span class="token comment"># 创建容器 但不启动</span>
</code></pre></div><p><strong>退出容器</strong></p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token builtin class-name">exit</span>              <span class="token comment">#容器停止并退出到主机</span>
Ctrl + p + q      <span class="token comment">#不终止容器退出容器</span>
</code></pre></div><p><strong>查看容器</strong></p> <div class="language-xhell extra-class"><pre class="language-text"><code>docker ps          # 列处正在运行的容器
docker ps -a       # 列出历史运行的容器
docker ps -n=1     # 显示最近一条创建的容器
docker ps -q       # 只显示容器编号
</code></pre></div><p><strong>docker rm -f</strong>        #强制删除容器</p> <p><strong>容器启动和停止</strong></p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">docker</span> start        <span class="token comment">#启动容器</span>
<span class="token function">docker</span> restart      <span class="token comment">#重启容器</span>
<span class="token function">docker</span> stop         <span class="token comment">#停止容器</span>
<span class="token function">docker</span> <span class="token function">kill</span>         <span class="token comment">#暴力停止容器</span>
</code></pre></div><p><strong>进入容器</strong></p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">docker</span> attach 容器id              <span class="token comment">#退出后会停止容器</span>
<span class="token function">docker</span> <span class="token builtin class-name">exec</span> -it 容器id /bin/bash  <span class="token comment">#退出后容器不会停止</span>
</code></pre></div><p><strong>导出和导入容器</strong></p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">docker</span> <span class="token builtin class-name">export</span> 容器id <span class="token operator">&gt;</span> 名字.tar    <span class="token comment">#导出容器到tar包</span>
<span class="token function">cat</span> docker/ubuntu.tar <span class="token operator">|</span> <span class="token function">docker</span> <span class="token function">import</span> - test/ubuntu:v1 <span class="token comment">#将快照文件 ubuntu.tar 导入到镜像 test/ubuntu:v1</span>
</code></pre></div><p><strong>日志</strong></p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">docker</span> logs -ft bf08b7f2cd89      <span class="token comment">#像tail 一样查看所有日志</span>
<span class="token function">docker</span> logs -ft --tail <span class="token number">10</span> bf08b7f2cd89      <span class="token comment">#像tail 一样查看10条日志</span>
</code></pre></div><p><strong>查看容器中的进程信息</strong></p> <div class="language-xhell extra-class"><pre class="language-text"><code>docker top 容器id       #查看容器中的进程信息
</code></pre></div><p><strong>查看镜像元数据</strong></p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">docker</span> inspect 容器id   <span class="token comment">#查看容器详细信息</span>
</code></pre></div><p><strong>从容器内拷贝文件到主机上</strong></p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">docker</span> <span class="token function">cp</span> 容器id:容器内路径 目的主机路径   <span class="token comment">#拷贝容器内文件到主机</span>
</code></pre></div><p><strong>从主机拷贝到容器内 使用卷挂载</strong></p> <div class="language-shell extra-class"><pre class="language-shell"><code>-v 容器卷技术 实现容器和主机间文件互相同步
</code></pre></div><h3 id="容器卷相关"><a href="#容器卷相关" class="header-anchor">#</a> 容器卷相关</h3> <blockquote><p>容器卷用于实现容器和主机间数据同步，也可以为容器数据做持久化</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code>方式一： 直接使用命令 -v
<span class="token function">docker</span> run -it -v 主机目录:容器内目录 容器
</code></pre></div><h4 id="具名和匿名挂载"><a href="#具名和匿名挂载" class="header-anchor">#</a> 具名和匿名挂载</h4> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># 匿名挂载</span>
<span class="token function">docker</span> run -it -v 容器内目录      <span class="token comment">#不写主机路径  就是匿名挂载</span>
<span class="token function">docker</span> run -it -v 名字：容器内目录 <span class="token comment"># 指定名字就是具名挂载</span>
<span class="token function">docker</span> volume <span class="token punctuation">[</span>参数<span class="token punctuation">]</span>  查看卷信息
可选参数
 <span class="token function">ls</span>                              <span class="token comment">#查看所有volume</span>
 inspect <span class="token punctuation">[</span>volume_name<span class="token punctuation">]</span>           <span class="token comment">#查看某一个volume的挂载信息</span>
</code></pre></div><div class="language-shell extra-class"><pre class="language-shell"><code>方式二： 通过dockerfile初始化时候直接挂载好
</code></pre></div><h4 id="dockerfile相关"><a href="#dockerfile相关" class="header-anchor">#</a> Dockerfile相关</h4> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># 编写Dockerfile</span>
FROM centos
MAINTAINER echooo<span class="token operator">&lt;</span>echoooo_@outlook.com<span class="token operator">&gt;</span>
VOLUME <span class="token punctuation">[</span><span class="token string">&quot;volume1&quot;</span>,<span class="token string">&quot;/home&quot;</span><span class="token punctuation">]</span>  <span class="token comment">#可以具名也可以匿名</span>
CMD <span class="token builtin class-name">echo</span> <span class="token string">&quot;-----end-----&quot;</span>
CMD /bin/bash
<span class="token comment"># 够建images</span>
<span class="token function">docker</span> build -f ./Dockerfile -t echooo/centos:1.0 <span class="token builtin class-name">.</span>
</code></pre></div><h4 id="dockfile相关指令"><a href="#dockfile相关指令" class="header-anchor">#</a> Dockfile相关指令</h4> <div class="language-shell extra-class"><pre class="language-shell"><code>FROM        <span class="token comment">#定制的镜像都是基于 FROM 的镜像</span>
MAINTAINER  <span class="token comment">#指定作者</span>
CMD         <span class="token comment">#是容器启动时执行的命令</span>
ENTRYPOINT  <span class="token comment">#启动时的默认命令，</span>
RUN         <span class="token comment">#构件容器时就运行的命令以及提交运行结果</span>
LABEL       <span class="token comment">#为镜像指定标签</span>
EXPOSE      <span class="token comment">#暴漏容器运行时的监听端口给外部，如果想使得容器与主机的端口有映射关系，必须在容器启动的时候加上 -P参数</span>
ENV         <span class="token comment">#设置环境变量</span>
ARG         <span class="token comment">#构建参数，与 ENV 作用一至。不过作用域不一样。ARG 设置的环境变量仅对 Dockerfile 内有效</span>
ADD         <span class="token comment">#把文件复制到镜像中，src可以是远程</span>
COPY        <span class="token comment">#把文件复制到镜像中，与add的区别是 src只能是本地文件</span>
VOLUME      <span class="token comment">#实现挂载功能</span>
WORKDIR     <span class="token comment">#设置工作目录</span>
HEALTHCHECK <span class="token comment">#用于指定某个程序或者指令来监控 docker 容器服务的运行状态</span>
ONBUILD     <span class="token comment">#用于延迟构建命令的执行</span>
</code></pre></div><h4 id="数据卷容器"><a href="#数据卷容器" class="header-anchor">#</a> 数据卷容器</h4> <blockquote><p>多个容器之间做数据同步，而且可以互相同步</p> <p>如：容器A从父容器B同步数据，使用--volumes-from</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># 先启动父容器</span>
<span class="token function">docker</span> run -itd --name contain01 容器id
<span class="token comment"># 启动子容器</span>
<span class="token function">docker</span> run -itd --name contain02 --volumes-from contain01 容器id
当父容器修改数据后即可自动同步到子容器，反之也可
</code></pre></div><h3 id="实战-创建自己的centos"><a href="#实战-创建自己的centos" class="header-anchor">#</a> 实战-创建自己的centos</h3> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># 编写自己的centos Dockerfile</span>
FROM centos
MAINTAINER echooo<span class="token operator">&lt;</span>echoooo_@outlook.com<span class="token operator">&gt;</span>
ENV MYPATH /usr/local
WORKDIR <span class="token variable">$MYPATH</span>
VOLUME <span class="token punctuation">[</span><span class="token string">&quot;volume1&quot;</span>,<span class="token string">&quot;volume2:/home&quot;</span><span class="token punctuation">]</span>
RUN yum -y <span class="token function">install</span> <span class="token function">vim</span>
RUN yum -y <span class="token function">install</span> net-tools
EXPOSE <span class="token number">80</span>
CMD <span class="token builtin class-name">echo</span> <span class="token string">&quot;----------MYPAHT=<span class="token variable">$MYPATH</span>&quot;</span>
CMD <span class="token builtin class-name">echo</span> <span class="token string">&quot;-----build finish-----&quot;</span>
CMD /bin/bash
</code></pre></div><h3 id="网络"><a href="#网络" class="header-anchor">#</a> 网络</h3> <blockquote><p>容器之间互联是怎么实现？</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">docker</span> network <span class="token comment">#查看docker网络情况</span>
</code></pre></div><h4 id="容器互联"><a href="#容器互联" class="header-anchor">#</a> 容器互联</h4> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># 先容器1</span>
<span class="token function">docker</span> run -itd --name contain01 容器id /bin/bash
<span class="token comment"># 启动容器2 --link到容器1</span>
<span class="token function">docker</span> run -itd --name contain02 --link contain01 容器id /bin/bash
<span class="token comment"># 现在进入到容器2后，即可通过name ping通</span>
</code></pre></div><h4 id="自定义网络"><a href="#自定义网络" class="header-anchor">#</a> 自定义网络</h4> <blockquote><p>使用自定义网络，可以不用--link手动建立，默认即可ping 通</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># 创建自定义网络</span>
<span class="token function">docker</span> network create
<span class="token comment">#例子</span>
<span class="token function">docker</span> network create --driver bridge --subnet <span class="token number">192.168</span>.0.0/16 --gateway <span class="token number">192.168</span>.0.1 mynet
<span class="token comment">#查看网络详细信息</span>
<span class="token function">docker</span> network inspect mynet
</code></pre></div><h3 id="实战"><a href="#实战" class="header-anchor">#</a> 实战</h3> <h4 id="部署tomcat"><a href="#部署tomcat" class="header-anchor">#</a> 部署tomcat</h4> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">docker</span> run -d -p <span class="token number">8080</span>:8080 tomcat
</code></pre></div><h4 id="部署redis集群"><a href="#部署redis集群" class="header-anchor">#</a> 部署redis集群</h4> <blockquote><p>分片模式</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># 编写脚本</span>
<span class="token keyword">for</span> <span class="token for-or-select variable">port</span> <span class="token keyword">in</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">seq</span> <span class="token number">1</span> <span class="token number">6</span><span class="token variable">)</span></span><span class="token punctuation">;</span> <span class="token punctuation">\</span>
<span class="token keyword">do</span> <span class="token punctuation">\</span>
<span class="token function">mkdir</span> -p /mydata/redis/node-<span class="token variable">${port}</span>/conf
<span class="token function">touch</span> /mydata/redis/node-<span class="token variable">${port}</span>/conf/redis.conf
<span class="token function">cat</span> <span class="token operator">&lt;&lt;</span> <span class="token string">EOF<span class="token bash punctuation"> <span class="token operator">&gt;</span>//mydata/redis/node-<span class="token variable">${port}</span>/conf/redis.conf</span>
port 6379
bind 0.0.0.0
cluster-enabled yes
cluster-config-file nodes.conf
cluster-node-timeout 5000
cluster-announce-ip 192.168.0.1<span class="token variable">${port}</span>
cluster-announce-port 6379
cluster-announce-bus-port 16379
appendonly yes
EOF</span>
<span class="token keyword">done</span>
<span class="token comment">#启动redis</span>
<span class="token keyword">for</span> <span class="token for-or-select variable">port</span> <span class="token keyword">in</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">seq</span> <span class="token number">1</span> <span class="token number">6</span><span class="token variable">)</span></span><span class="token punctuation">;</span> <span class="token punctuation">\</span>
<span class="token keyword">do</span> <span class="token punctuation">\</span>
<span class="token function">docker</span> run -p <span class="token number">637</span><span class="token variable">${port}</span>:6379 -p <span class="token number">1637</span><span class="token variable">${port}</span>:16379 --name redis-<span class="token variable">${port}</span> <span class="token punctuation">\</span>
-v /mydata/redis/node-<span class="token variable">${port}</span>/data:/data <span class="token punctuation">\</span>
-v /mydata/redis/node-<span class="token variable">${port}</span>/conf/redis.conf:/etc/redis/redis.conf <span class="token punctuation">\</span>
-d --net redis --ip <span class="token number">192.168</span>.0.1<span class="token variable">${port}</span> redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf
<span class="token keyword">done</span>
<span class="token comment">#创建集群</span>
redis-cli --cluster create <span class="token number">192.168</span>.0.11:6379 <span class="token number">192.168</span>.0.12:6379 <span class="token number">192.168</span>.0.13:6379 <span class="token number">192.168</span>.0.14:6379 <span class="token number">192.168</span>.0.15:6379 <span class="token number">192.168</span>.0.16:6379 --cluster-replicas <span class="token number">1</span>
</code></pre></div><h4 id="部署自己的springboot"><a href="#部署自己的springboot" class="header-anchor">#</a> 部署自己的springboot</h4> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># 编写dockerfile</span>
FROM java:8
MAINTAINER echooo<span class="token operator">&lt;</span>echoooo_@outlook.com<span class="token operator">&gt;</span>
COPY *.jar /snowball.jar
CMD <span class="token punctuation">[</span><span class="token string">&quot;--server.port=8080&quot;</span><span class="token punctuation">]</span>
EXPOSE <span class="token number">8080</span>
ENTRYPOINT <span class="token punctuation">[</span><span class="token string">&quot;java&quot;</span>,<span class="token string">&quot;-jar&quot;</span>,<span class="token string">&quot;/snowball.jar&quot;</span><span class="token punctuation">]</span>
<span class="token comment"># build 然后run</span>
<span class="token function">docker</span> run -itd -p <span class="token number">8080</span>:8080 584e346787a6
</code></pre></div><h3 id="docker-compose"><a href="#docker-compose" class="header-anchor">#</a> Docker Compose</h3> <h4 id="docker-compose-安装"><a href="#docker-compose-安装" class="header-anchor">#</a> <strong>docker compose</strong> 安装</h4> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># 1、安装，使用国内镜像</span>
<span class="token function">curl</span> -L https://get.daocloud.io/docker/compose/releases/download/1.27.4/docker-compose-<span class="token variable"><span class="token variable">`</span><span class="token function">uname</span> -s<span class="token variable">`</span></span>-<span class="token variable"><span class="token variable">`</span><span class="token function">uname</span> -m<span class="token variable">`</span></span> <span class="token operator">&gt;</span> /usr/local/bin/docker-compose
<span class="token comment"># 2、修改权限</span>
<span class="token function">chmod</span> +x /usr/local/bin/docker-compose
<span class="token comment"># 3、验证</span>
<span class="token function">docker-compose</span> --version
</code></pre></div><h4 id="体验-官网"><a href="#体验-官网" class="header-anchor">#</a> 体验(官网)</h4> <blockquote><p>https://docs.docker.com/compose/gettingstarted/</p></blockquote> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># 1、创建目录</span>
 <span class="token function">mkdir</span> composetest
 <span class="token builtin class-name">cd</span> composetest
<span class="token comment"># 2、创建app.py</span>
<span class="token function">import</span> <span class="token function">time</span>
<span class="token function">import</span> redis
from flask <span class="token function">import</span> Flask
app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>
cache <span class="token operator">=</span> redis.Redis<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'redis'</span>, <span class="token assign-left variable">port</span><span class="token operator">=</span><span class="token number">6379</span><span class="token punctuation">)</span>
def get_hit_count<span class="token punctuation">(</span><span class="token punctuation">)</span>:
    retries <span class="token operator">=</span> <span class="token number">5</span>
    <span class="token keyword">while</span> True:
        try:
            <span class="token builtin class-name">return</span> cache.incr<span class="token punctuation">(</span><span class="token string">'hits'</span><span class="token punctuation">)</span>
        except redis.exceptions.ConnectionError as exc:
            <span class="token keyword">if</span> retries <span class="token operator">==</span> <span class="token number">0</span>:
                raise exc
            retries -<span class="token operator">=</span> <span class="token number">1</span>
            time.sleep<span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span>
@app.route<span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span>
def hello<span class="token punctuation">(</span><span class="token punctuation">)</span>:
    count <span class="token operator">=</span> get_hit_count<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token builtin class-name">return</span> <span class="token string">'Hello World! I have been seen {} times.\n'</span>.format<span class="token punctuation">(</span>count<span class="token punctuation">)</span>
<span class="token comment"># 3、编写requirements.txt</span>
flask
redis
<span class="token comment"># 4、编写Dockerfile</span>
FROM python:3.7-alpine
WORKDIR /code
ENV <span class="token assign-left variable">FLASK_APP</span><span class="token operator">=</span>app.py
ENV <span class="token assign-left variable">FLASK_RUN_HOST</span><span class="token operator">=</span><span class="token number">0.0</span>.0.0
RUN apk <span class="token function">add</span> --no-cache gcc musl-dev linux-headers
COPY requirements.txt requirements.txt
RUN pip <span class="token function">install</span> -r requirements.txt
EXPOSE <span class="token number">5000</span>
COPY <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span>
CMD <span class="token punctuation">[</span><span class="token string">&quot;flask&quot;</span>, <span class="token string">&quot;run&quot;</span><span class="token punctuation">]</span>
<span class="token comment"># 5、编写docker-compose.yml</span>
version: <span class="token string">&quot;3.9&quot;</span>
services:
  web:
    build: <span class="token builtin class-name">.</span>
    ports:
      - <span class="token string">&quot;5000:5000&quot;</span>
  redis:
    image: <span class="token string">&quot;redis:alpine&quot;</span>
<span class="token comment"># 6、启动</span>
<span class="token function">docker-compose</span> up
<span class="token comment"># 7、访问</span>
localhost:5000
</code></pre></div><h4 id="开发自己的springboot服务"><a href="#开发自己的springboot服务" class="header-anchor">#</a> 开发自己的springboot服务</h4> <p>1、开发springboot服务</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> testController <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">StringRedisTemplate</span> stringRedisTemplate<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/hello&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">testRedis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">Long</span> view <span class="token operator">=</span> stringRedisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">increment</span><span class="token punctuation">(</span><span class="token string">&quot;view&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">&quot;welcome,views : &quot;</span> <span class="token operator">+</span> view<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>2、编写Dockerfile</p> <div class="language-shell extra-class"><pre class="language-shell"><code>FROM java:8
COPY *.jar /app.jar
CMD <span class="token punctuation">[</span><span class="token string">&quot;--server.port=8080&quot;</span><span class="token punctuation">]</span>
EXPOSE <span class="token number">8080</span>
ENTRYPOINT <span class="token punctuation">[</span><span class="token string">&quot;java&quot;</span>,<span class="token string">&quot;-jar&quot;</span>,<span class="token string">&quot;app.jar&quot;</span><span class="token punctuation">]</span>
</code></pre></div><p>3、编写docker-compose.yml</p> <div class="language-shell extra-class"><pre class="language-shell"><code>version: <span class="token string">&quot;3.9&quot;</span>
services:
  snowballredis:
    build: <span class="token builtin class-name">.</span>
    image: snowball
    depends_on:
      - redis
    ports:
      - <span class="token string">&quot;8080:8080&quot;</span>
  redis:
    image: <span class="token string">&quot;redis:alpine&quot;</span>
</code></pre></div><p>4、启动</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">docker-compose</span> up
</code></pre></div></div></article> <section class="post-meta main-div" data-v-4e23451f><section class="post-date clearfix" data-v-4e23451f><span class="create-date" data-v-4e23451f>
      发布时间 : 2020-11-23
    </span> <span class="update-date" data-v-4e23451f>
      最后修改 : 2022-12-07
    </span></section> <section class="post-links" data-v-4e23451f><a href="/csrsm-blog/posts/2020/11/23/http.html" class="post-link" data-v-4e23451f>
      上一篇 : http简介
    </a> <a href="/csrsm-blog/posts/2021/01/21/change-datasource.html" class="post-link" data-v-4e23451f>
      下一篇 : Mybatis多数据源切换
    </a></section></section> <div id="post-comments" class="main-div"><!----></div></div></main> <aside class="aside" data-v-4dd605a1><div class="info-card main-div" data-v-9d847660 data-v-4dd605a1><div class="info-card-header" style="background-size:cover;background-repeat:no-repeat;background-position:center;background-attachment:scroll;background-image:url(http://img.icoisini.xyz/wx-background.jpg);" data-v-9d847660><img src="http://img.icoisini.xyz/cm.jpg" alt="小二哥" class="info-avatar" data-v-9d847660></div> <div class="info-card-body" data-v-9d847660><section class="info-nickname" data-v-9d847660>
      小二哥
    </section> <section class="info-desc" data-v-9d847660>Don`t Worry Be Happy!</section> <section class="info-contact" data-v-9d847660><section data-v-9d847660><span title="DaLian City, China" data-v-9d847660 data-v-9d847660><svg class="icon" style="font-size:1em;" data-v-9d847660 data-v-9d847660><title data-v-9d847660 data-v-9d847660>DaLian City, China</title><use xlink:href="#icon-location" data-v-9d847660 data-v-9d847660></use></svg><span class="info-text" data-v-9d847660 data-v-9d847660>
          DaLian City, China
        </span></span></section> <section data-v-9d847660><span title="DaLian University of Technology" data-v-9d847660 data-v-9d847660><svg class="icon" style="font-size:1em;" data-v-9d847660 data-v-9d847660><title data-v-9d847660 data-v-9d847660>DaLian University of Technology</title><use xlink:href="#icon-organization" data-v-9d847660 data-v-9d847660></use></svg><span class="info-text" data-v-9d847660 data-v-9d847660>
          DaLian University of Technology
        </span></span></section> <section data-v-9d847660><a href="mailto:csrsming@163.com" title="csrsming@163.com" data-v-9d847660 data-v-9d847660><svg class="icon" style="font-size:1em;" data-v-9d847660 data-v-9d847660><title data-v-9d847660 data-v-9d847660>csrsming@163.com</title><use xlink:href="#icon-email" data-v-9d847660 data-v-9d847660></use></svg><span class="info-text" data-v-9d847660 data-v-9d847660>
          csrsming@163.com
        </span></a></section></section></div> <div class="info-card-footer" data-v-9d847660><section class="info-sns clearfix" data-v-9d847660><a href="https://github.com/csrsm" target="_blank" class="sns-link" data-v-9d847660><span title="GitHub: csrsm" class="sns-icon" data-v-9d847660 data-v-9d847660><svg class="icon" style="font-size:1.5em;" data-v-9d847660 data-v-9d847660><title data-v-9d847660 data-v-9d847660>GitHub: csrsm</title><use xlink:href="#icon-github" data-v-9d847660 data-v-9d847660></use></svg></span></a></section></div></div> <div class="post-nav-card main-div" style="position:relative;top:0;width:0px;" data-v-4dd605a1><!----> <div class="post-nav-comments"><svg class="icon"><title>comment</title><use xlink:href="#icon-comment"></use></svg> <a href="/csrsm-blog/posts/2020/11/23/docker.html#post-comments">
      评论
    </a></div></div></aside></div> <footer class="footer" data-v-1375e54c><p class="footer-sns-links" data-v-1375e54c><a href="https://github.com/csrsm" target="_blank" class="sns-link" data-v-1375e54c><span title="GitHub: csrsm" class="sns-icon" data-v-1375e54c data-v-1375e54c><svg class="icon" style="font-size:25px;" data-v-1375e54c data-v-1375e54c><title data-v-1375e54c data-v-1375e54c>GitHub: csrsm</title><use xlink:href="#icon-github" data-v-1375e54c data-v-1375e54c></use></svg></span></a></p> <!----> <p class="footer-text" data-v-1375e54c>Copyright 2016-present <a href="https://github.com/csrsm" target="_blank">csrsm</a></p></footer></div><div class="global-ui"><!----><!----></div></div>
    <script src="/csrsm-blog/assets/js/app.acc1d91f.js" defer></script><script src="/csrsm-blog/assets/js/7.8eaaf042.js" defer></script><script src="/csrsm-blog/assets/js/18.e106ea76.js" defer></script>
  </body>
</html>
