<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>大数据基础 | Csrsm</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/post-ci/favicon.ico">
    <meta name="description" content="This is my blog">
    <link rel="preload" href="/post-ci/assets/css/0.styles.0012e2a3.css" as="style"><link rel="preload" href="/post-ci/assets/js/app.bf965bf3.js" as="script"><link rel="preload" href="/post-ci/assets/js/7.8eaaf042.js" as="script"><link rel="preload" href="/post-ci/assets/js/17.d4868fcd.js" as="script"><link rel="prefetch" href="/post-ci/assets/js/1.2e718cca.js"><link rel="prefetch" href="/post-ci/assets/js/10.503da5e1.js"><link rel="prefetch" href="/post-ci/assets/js/11.9d2fdfae.js"><link rel="prefetch" href="/post-ci/assets/js/12.fcb21a1d.js"><link rel="prefetch" href="/post-ci/assets/js/13.96503fd7.js"><link rel="prefetch" href="/post-ci/assets/js/14.20d93468.js"><link rel="prefetch" href="/post-ci/assets/js/15.64bd5037.js"><link rel="prefetch" href="/post-ci/assets/js/16.b9a58e29.js"><link rel="prefetch" href="/post-ci/assets/js/18.e106ea76.js"><link rel="prefetch" href="/post-ci/assets/js/19.ebf1a903.js"><link rel="prefetch" href="/post-ci/assets/js/20.0e2eae33.js"><link rel="prefetch" href="/post-ci/assets/js/21.4752cac2.js"><link rel="prefetch" href="/post-ci/assets/js/22.0a18be31.js"><link rel="prefetch" href="/post-ci/assets/js/23.000382ea.js"><link rel="prefetch" href="/post-ci/assets/js/24.db68ac55.js"><link rel="prefetch" href="/post-ci/assets/js/25.49125fea.js"><link rel="prefetch" href="/post-ci/assets/js/26.ab5421fe.js"><link rel="prefetch" href="/post-ci/assets/js/27.64c1a036.js"><link rel="prefetch" href="/post-ci/assets/js/28.df4e177c.js"><link rel="prefetch" href="/post-ci/assets/js/29.02d1758b.js"><link rel="prefetch" href="/post-ci/assets/js/3.ff189134.js"><link rel="prefetch" href="/post-ci/assets/js/30.90db0b1a.js"><link rel="prefetch" href="/post-ci/assets/js/31.b371235e.js"><link rel="prefetch" href="/post-ci/assets/js/32.a1231124.js"><link rel="prefetch" href="/post-ci/assets/js/33.d558d933.js"><link rel="prefetch" href="/post-ci/assets/js/34.d7d644b4.js"><link rel="prefetch" href="/post-ci/assets/js/35.eb22c3ab.js"><link rel="prefetch" href="/post-ci/assets/js/36.bed5cd89.js"><link rel="prefetch" href="/post-ci/assets/js/37.f8911c28.js"><link rel="prefetch" href="/post-ci/assets/js/38.1ff48400.js"><link rel="prefetch" href="/post-ci/assets/js/39.c6f256ac.js"><link rel="prefetch" href="/post-ci/assets/js/4.326ff035.js"><link rel="prefetch" href="/post-ci/assets/js/40.55598602.js"><link rel="prefetch" href="/post-ci/assets/js/41.41fb4af9.js"><link rel="prefetch" href="/post-ci/assets/js/42.9fd7723b.js"><link rel="prefetch" href="/post-ci/assets/js/43.88e37717.js"><link rel="prefetch" href="/post-ci/assets/js/44.2a443682.js"><link rel="prefetch" href="/post-ci/assets/js/45.377399cb.js"><link rel="prefetch" href="/post-ci/assets/js/46.a5414bf6.js"><link rel="prefetch" href="/post-ci/assets/js/47.a43294de.js"><link rel="prefetch" href="/post-ci/assets/js/48.8742461a.js"><link rel="prefetch" href="/post-ci/assets/js/49.b778b074.js"><link rel="prefetch" href="/post-ci/assets/js/5.f96cd824.js"><link rel="prefetch" href="/post-ci/assets/js/50.186a336f.js"><link rel="prefetch" href="/post-ci/assets/js/6.562b2ef1.js"><link rel="prefetch" href="/post-ci/assets/js/8.40f58b51.js"><link rel="prefetch" href="/post-ci/assets/js/9.c8fcfbba.js">
    <link rel="stylesheet" href="/post-ci/assets/css/0.styles.0012e2a3.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="vuepress-theme-meteorlxy"><header class="header" style="background-size:cover;background-repeat:no-repeat;background-position:center;background-attachment:scroll;background-image:url(http://img.icoisini.xyz/background.jpg);" data-v-7a046aea><div data-v-e4145d0a data-v-7a046aea><nav class="navbar" data-v-e4145d0a><div class="container" data-v-e4145d0a><a href="/post-ci/" class="router-link-active" data-v-e4145d0a><span class="navbar-site-name" data-v-e4145d0a>
          Csrsm
        </span></a> <div class="navbar-toggler" data-v-e4145d0a><svg class="icon" style="font-size:1.2em;" data-v-e4145d0a data-v-e4145d0a><title data-v-e4145d0a data-v-e4145d0a>menu</title><use xlink:href="#icon-menu" data-v-e4145d0a data-v-e4145d0a></use></svg></div> <div class="navbar-links" data-v-e4145d0a><a href="/post-ci/" class="navbar-link" data-v-e4145d0a>
            首页
          </a><a href="/post-ci/posts/" class="navbar-link router-link-active" data-v-e4145d0a>
            Csrsm
          </a></div></div></nav> <div class="navbar-holder" style="display:none;" data-v-e4145d0a></div></div> <div class="banner" data-v-98d6aa8c data-v-7a046aea data-v-7a046aea><div class="container" data-v-98d6aa8c><div class="center" data-v-98d6aa8c><h1 data-v-98d6aa8c data-v-7a046aea>
          大数据基础
        </h1></div></div></div></header> <div class="container clearfix show-aside" data-v-4dd605a1 data-v-4dd605a1><main class="main" data-v-4dd605a1><div class="post" data-v-4dd605a1 data-v-4dd605a1><section class="post-meta main-div" data-v-4e23451f><section class="post-date clearfix" data-v-4e23451f><span class="create-date" data-v-4e23451f>
      发布时间 : 2022-05-02
    </span> <span class="update-date" data-v-4e23451f>
      最后修改 : 2022-12-08
    </span></section> <section class="post-links" data-v-4e23451f><a href="/post-ci/posts/2022/05/02/java-collection.html" class="post-link" data-v-4e23451f>
      上一篇 : Java容器集合
    </a> <a href="/post-ci/posts/2022/05/10/springcloud-component.html" class="post-link" data-v-4e23451f>
      下一篇 : springcloud各个组件
    </a></section></section> <article class="main-div"><div class="post-content content content__default"><h2 id="_1-数据仓库分层"><a href="#_1-数据仓库分层" class="header-anchor">#</a> 1.数据仓库分层</h2> <img src="/post-ci/img/bigdata/数仓分层.png" alt="单架构"> <p>--------------------------------------------范式建模begin----------------------------------------------------------</p> <ol><li><p>**ODS层（operational data source）：**操作数据层，直接存放业务系统抽取过来的数据，将不同业务系统中的数据汇聚在一起</p></li> <li><p>**DW层（data warehouse）：**数据仓库，按照主题建立各种数据模型</p></li></ol> <ul><li>**DWD层（data warehouse detail）：**数据明细层，保证数据质量，在ods的基础上对数据进行加工处理，提供更干净的数据
--------------------------------------------范式建模bend----------------------------------------------------------</li></ul> <p>--------------------------------------------维度建模begin----------------------------------------------------------</p> <ul><li>**DWM层（data warehouse middle）：**数据中间层，对通用的维度进行轻度聚合，计算相应的统计指标，方便复用</li> <li>**DWS层（data warehouse service）：**数据服务层，按照主题业务组织主题宽表，用于OLAP分析</li></ul> <ol start="3"><li>**DM层（data market）：**数据集市层，基于DW层的基础数据，整合汇总成分析某一个主题域的报表数据
--------------------------------------------维度建模end----------------------------------------------------------</li></ol> <p><strong>分层的目的：</strong></p> <ol><li>清晰的数据结构</li> <li>减少重复开发</li> <li>统一数据出口</li> <li>简化问题</li></ol> <h2 id="_2-数据库-oltp与数据仓库的区别-olap"><a href="#_2-数据库-oltp与数据仓库的区别-olap" class="header-anchor">#</a> 2.数据库-OLTP与数据仓库的区别-OLAP</h2> <table><thead><tr><th>功能</th> <th>数据库</th> <th>数据差仓库</th></tr></thead> <tbody><tr><td>数据范围</td> <td>当前状态数据</td> <td>存储完整、反映历史变化数据</td></tr> <tr><td>数据变化</td> <td>支持频繁的增删改查</td> <td>可增加、查询、无更新、删除操作</td></tr> <tr><td>应用场景</td> <td>面向业务交易流程</td> <td>面向分析、侧重决策分析</td></tr> <tr><td>处理数据量</td> <td>频繁、小批次、高并发、低延迟</td> <td>非频繁、大批量、高吞吐、有延迟</td></tr> <tr><td>设计理论</td> <td>遵循数据库三范式、避免冗余</td> <td>违范式、适当冗余</td></tr> <tr><td>建模方式</td> <td>ER实体关系建模（范式建模）</td> <td>范式建模+维度建模</td></tr></tbody></table> <h2 id="_3-大数据技术栈"><a href="#_3-大数据技术栈" class="header-anchor">#</a> 3.大数据技术栈</h2> <h3 id="_1-架构底层核心技术"><a href="#_1-架构底层核心技术" class="header-anchor">#</a> 1.架构底层核心技术：</h3> <ol><li>JVM</li> <li>多线程、高并发</li> <li>IO</li></ol> <h3 id="_2-数据采集体系技术"><a href="#_2-数据采集体系技术" class="header-anchor">#</a> 2.数据采集体系技术</h3> <ol><li>sqoop</li> <li>DataX</li> <li>Kettle</li> <li>Flume</li> <li>Maxwell</li> <li>Canal</li> <li>Nifi</li></ol> <h3 id="_3-中间件技术栈"><a href="#_3-中间件技术栈" class="header-anchor">#</a> 3.中间件技术栈</h3> <ol><li>zookeeper 分布式协调服务</li> <li>redis 分布式缓存</li> <li>kafka 分布式消息系统</li> <li>Pulsar 分布式消息系统</li> <li>ELK stack 数据分析</li></ol> <h3 id="_4-分布式存储"><a href="#_4-分布式存储" class="header-anchor">#</a> 4.分布式存储</h3> <ol><li>HDFS 分布式文件系统</li> <li>HBase 分布式数据库</li> <li>Hive 分布式数仓</li> <li>Hudi、Delta lack、Iceberg 数据湖技术</li></ol> <h3 id="_5-数据处理技术"><a href="#_5-数据处理技术" class="header-anchor">#</a> 5.数据处理技术</h3> <ol><li>MapReduce 分布式计算框架</li> <li>Spark 分布式计算框架</li> <li>Flink 分布式计算框架</li></ol> <h3 id="_6-olap生态系统"><a href="#_6-olap生态系统" class="header-anchor">#</a> 6.OLAP生态系统</h3> <p>（1）OLAP-Kylin
（2）OLAP-Presto
（3）OLAP-Druid
（4）OLAP-Impala
（5）OLAP-ClickHouse
（6）OLAP-Phoenix、Kudu、Doirs等等</p> <h3 id="_7-稳健架构设计"><a href="#_7-稳健架构设计" class="header-anchor">#</a> 7.稳健架构设计</h3> <ol><li>离线数仓架构方法论</li> <li>实时数仓架构方法论</li> <li>数据治理-数据质量管理</li> <li>数据治理-元数据管理</li> <li>数据治理-数据安全管理</li> <li>Kerberos</li> <li>数据中台构建方法论</li> <li>可视化</li></ol> <h3 id="_8-集群调度体系"><a href="#_8-集群调度体系" class="header-anchor">#</a> 8.集群调度体系</h3> <ol><li>分布式资源调度 Yarn</li> <li>任务流调度 oozie</li> <li>任务流调度 Azkaban</li> <li>任务流调度 Airflow</li> <li>集群管理平台 cloudera manager</li> <li>集群管理平台 Ambari</li></ol> <h3 id="_9-数据挖掘体系相关"><a href="#_9-数据挖掘体系相关" class="header-anchor">#</a> 9.数据挖掘体系相关</h3> <ol><li>python</li> <li>多元线性回归</li> <li>贝叶斯算法</li> <li>KNN算法</li> <li>KMeans算法</li> <li>KMeans++</li> <li>TF-IDF</li> <li>逻辑回归</li> <li>决策树</li> <li>随机森林等等</li></ol> <h2 id="_4-大数据架构演变"><a href="#_4-大数据架构演变" class="header-anchor">#</a> 4.大数据架构演变</h2> <h3 id="_1-lambda架构-离线处理-实时链路"><a href="#_1-lambda架构-离线处理-实时链路" class="header-anchor">#</a> 1.Lambda架构（离线处理+实时链路）</h3> <img src="/post-ci/img/bigdata/传统离线架构.jpg" alt="传统离线架构"> <img src="/post-ci/img/bigdata/Lambda架构-传统实时开发.jpg" alt="Lambda架构-传统实时开发"> <h4 id="_1-离线处理"><a href="#_1-离线处理" class="header-anchor">#</a> 1.离线处理</h4> <ul><li>数据采集：Sqoop、DataX</li> <li>基于Hive的离线数仓：ODS、DWD、DWM、DWS、DM</li> <li>离线结果查询：Impala、Mysql （T+1）</li></ul> <h4 id="_2-实时处理"><a href="#_2-实时处理" class="header-anchor">#</a> 2.实时处理</h4> <ul><li>数据采集：Flume、Canal、Maxwell</li> <li>实时计算链路：Kafka、SparkStream、Flink</li> <li>实时结果存储：HBase、Redis、Mysql</li></ul> <h4 id="_3-缺点"><a href="#_3-缺点" class="header-anchor">#</a> 3. 缺点</h4> <ul><li>实时链路烟囱式开发，数据不能复用</li></ul> <h3 id="_2-lambda架构-离线数仓-实时数仓"><a href="#_2-lambda架构-离线数仓-实时数仓" class="header-anchor">#</a> 2.Lambda架构（离线数仓+实时数仓）</h3> <img src="/post-ci/img/bigdata/Lambda架构-实时数仓.jpg" alt="Lambda架构-实时数仓"> <h4 id="_1-离线处理-2"><a href="#_1-离线处理-2" class="header-anchor">#</a> 1.离线处理</h4> <ul><li>数据采集：Sqoop、DataX</li> <li>基于Hive的离线数仓：ODS、DWD、DWM、DWS、DM</li> <li>离线结果查询：Impala、Mysql （T+1）</li></ul> <h4 id="_2-实时处理-2"><a href="#_2-实时处理-2" class="header-anchor">#</a> 2.实时处理</h4> <ul><li>数据采集：Flume、Canal、Maxwell</li> <li>实时数据仓库：ODS+Kafka、DWD+Kafka、DWM+Kafka、DWS+Kafka、SparkStream、DM+HBase或Redis或Mysql或ES</li></ul> <h4 id="_3-缺点-2"><a href="#_3-缺点-2" class="header-anchor">#</a> 3.缺点</h4> <ul><li>同样需求需要开发两套一样的代码</li> <li>集群资源使用增多</li> <li>计算结果不一致，以离线结果为主</li> <li>批量计算T+1可能计算不完，资源不变，数据量越来越大</li> <li>服务器存储大</li></ul> <h3 id="_3-kappa架构"><a href="#_3-kappa架构" class="header-anchor">#</a> 3.Kappa架构</h3> <img src="/post-ci/img/bigdata/Kappa架构.jpg" alt="Kappa架构"> <h4 id="_1-实时数仓"><a href="#_1-实时数仓" class="header-anchor">#</a> 1.实时数仓</h4> <ul><li>数据采集：Flume、Canal、Maxwell</li> <li>实时数据仓库：ODS+Kafka、DWD+Kafka、DWM+Kafka、DWS+Kafka、SparkStream、DM+HBase或Redis或Mysql或ES</li></ul> <h4 id="_2-缺点"><a href="#_2-缺点" class="header-anchor">#</a> 2.缺点</h4> <ul><li>Kafka无法支撑海量数据存储</li> <li>Kafka不支持SQL查询，无法支持高效的OLAP</li> <li>无法复用数据血缘管理体系（错误溯源）</li> <li>为保证数仓计算数据的正确性，需要对数据进行更新，Kafka不支持update、upsert</li></ul> <h3 id="_4-架构选择"><a href="#_4-架构选择" class="header-anchor">#</a> 4.架构选择</h3> <h4 id="_1-公司刚上大数据或者公司业务没有实时场景"><a href="#_1-公司刚上大数据或者公司业务没有实时场景" class="header-anchor">#</a> 1.公司刚上大数据或者公司业务没有实时场景</h4> <p>选择传统离线大数据架构</p> <h4 id="_2-公司离线业务多-实时业务少"><a href="#_2-公司离线业务多-实时业务少" class="header-anchor">#</a> 2.公司离线业务多，实时业务少</h4> <p>离线数仓+实时链路的Lambda架构</p> <h4 id="_3-公司离线业务和实时业务都比较多"><a href="#_3-公司离线业务和实时业务都比较多" class="header-anchor">#</a> 3.公司离线业务和实时业务都比较多</h4> <p>离线数仓+实时数仓的Lambda架构</p> <h4 id="_4-公司实时业务多-离线业务相对少"><a href="#_4-公司实时业务多-离线业务相对少" class="header-anchor">#</a> 4.公司实时业务多，离线业务相对少</h4> <p>Kappa纯实时数仓架构</p> <blockquote><p>绝大多数公司采用Lambda架构</p> <p>互联网公司实时业务多混合架构（实时业务采用Kappa，关键核心业务使用离线全量计算方式Lambda）</p></blockquote> <h4 id="_5-一些互联网公司的架构示例"><a href="#_5-一些互联网公司的架构示例" class="header-anchor">#</a> 5.一些互联网公司的架构示例</h4> <img src="/post-ci/img/bigdata/滴滴架构.jpg" alt="滴滴架构"> <img src="/post-ci/img/bigdata/顺丰实时数仓架构.jpg" alt="顺丰实时数仓架构"> <img src="/post-ci/img/bigdata/网易业务链.jpg" alt="网易业务链"> <img src="/post-ci/img/bigdata/腾讯原有架构.jpg" alt="腾讯原有架构"> <img src="/post-ci/img/bigdata/腾讯改造后架构.jpg" alt="腾讯改造后架构"> <h3 id="_5-湖仓一体实时数据架构"><a href="#_5-湖仓一体实时数据架构" class="header-anchor">#</a> 5.湖仓一体实时数据架构</h3> <img src="/post-ci/img/bigdata/湖仓一体实时数仓.jpg" alt="湖仓一体实时数仓"> <blockquote><p>批流一体：既可以进行批处理，又可以进行流处理</p> <p>1.架构角度</p> <p>2.计算框架处理角度</p> <p>3.SQL支持角度</p> <p>4.存储层面</p></blockquote> <h4 id="_1-解决了以上架构的痛点"><a href="#_1-解决了以上架构的痛点" class="header-anchor">#</a> 1.解决了以上架构的痛点：</h4> <ul><li>存储统一</li> <li>Kafka存储量小的问题</li> <li>任意分层都可以进行OLAP数据分析</li> <li>复用同一套相同的血缘关系</li> <li>实时数据更新</li></ul> <h4 id="_2-缺点-2"><a href="#_2-缺点-2" class="header-anchor">#</a> 2.缺点</h4> <ul><li>技术较新，存在较多的bug</li> <li>数据湖技术数据存储速度没有Kafka快</li></ul> <h2 id="_5-hadoop"><a href="#_5-hadoop" class="header-anchor">#</a> 5.Hadoop</h2> <p>海量数据的分布式存储和计算平台，包含：</p> <ul><li>Hadoop Common：基础组件，包括数据IO，数据类型，序列化，安全等等</li> <li>Hadoop Distributed File System （HDFS）：分布式存储数据的文件管理系统，是在Linux的文件系统之上套了一层管理文件的软件技术</li> <li>Hadoop Yarn：作业调度和资源管理平台</li> <li>Hadoop MapReduce：分布式计算模型，适合批处理的计算任务</li></ul> <blockquote><p>批处理与流处理的区别：</p> <p>批处理：有界、持久、大量，非常适合需要访问全套记录才能完成的计算工作，一般用于离线统计。</p> <p>流处理：无界、实时，无需针对整个数据集执行操作，而是对通过系统传输的每个数据项执行操作，一般用于实时统计。</p> <p>spark与flink的区别：</p> <p>spark：一切都是由批次组成的，离线数据是一个大批次，而实时数据是有一个一个无限的小批次组成的。</p> <p>flink：一切都是由流组成的，离线数据是一个有界的流，而实时数据是一个没有界限的流，这就是所谓的有界流和无界流。</p></blockquote> <h3 id="_1-hdfs"><a href="#_1-hdfs" class="header-anchor">#</a> 1.HDFS</h3> <h4 id="_1-存储模型"><a href="#_1-存储模型" class="header-anchor">#</a> 1.存储模型</h4> <ul><li>文件线性按字节切割成块（block），具有offset、id</li> <li>文件与文件的block大小可以不一样</li> <li>一个文件除最后一个block，其他block大小一致</li> <li>block的大小依据硬件的I/O特性调整</li> <li>block被分散存放在集群的节点中，具有location（块在哪）</li> <li>block具有副本（replication），没有主从的概念，副本不能出现在同一个节点上</li> <li>副本是满足可靠性和性能的关键</li> <li>文件上传可以指定block大小和副本数，上传后只能修改副本数</li> <li>一次写入多次读取，不支持修改</li> <li>支持追加数据</li></ul> <h4 id="_2-架构设计"><a href="#_2-架构设计" class="header-anchor">#</a> 2.架构设计</h4> <ul><li>HDFS时一个主从架构</li> <li>有一个NameNode和一些DataNode组成</li> <li>面向文件包含：文件数据（data）和文件元数据（medadata）</li> <li>NameNode负责存储和管理文件元数据，并维护了一个层次型的文件目录树</li> <li>DataNode负责存储文件数据（block），并提供block的读写</li> <li>DataNode与NameNode维持心跳，并汇报自己持有的block信息</li> <li>Client和NameNode交互文件元数据和DataNode交互文件block数据</li></ul> <h4 id="_3-角色功能"><a href="#_3-角色功能" class="header-anchor">#</a> 3.角色功能</h4> <p>角色即JVM进程，NameNode、DataNode都是一个JVM进程</p> <p><strong>NameNode：</strong></p> <ul><li>完全基于内存存储文件元数据、目录结构、文件block的映射</li> <li>需要持久化方案保证数据可靠性</li> <li>提供副本放置策略</li></ul> <p><strong>DataNode：</strong></p> <ul><li>基于本地磁盘存储block</li> <li>并保存block的校验和保证数据block的可靠性</li> <li>与NameNode保持心跳、汇报block列表状态</li></ul> <h4 id="_4-元数据持久化"><a href="#_4-元数据持久化" class="header-anchor">#</a> 4.元数据持久化</h4> <ul><li><p>任何对文件系统元数据产生修改的操作，NameNode都会使用一种成为EditLog的事务日志记录下来（记录增删改操作）</p></li> <li><p>使用FsImage存储内存所有的元数据状态（快照/镜像，间隔发生，内存全量数据基于某个时间点做的向磁盘的溢写，瓶颈在I/O）</p></li> <li><p>使用本地磁盘保存EditLog和FsImage</p></li> <li><p>EditLog具有完整性，数据丢失少，但恢复速度慢，并有体积膨胀风险</p></li> <li><p>FsImage具有恢复速度快，体积与内存数据相当，但不能实时保存，数据丢失多</p></li> <li><p>NameNode使用了FsImage+EditLog整合的方案：</p> <ul><li>滚定将增量的EditLog更新到FsImage，以保证更新近时点的FsImage和更小的EditLog体积
<ul><li>最近时点的FI + 增量的EL</li> <li>10点  ===&gt;  9点的FI  + 9点到10点的EL，下次开机时，加载FI，加载EL，内存就得到了上次关机前全量的数据</li></ul></li></ul></li></ul> <h4 id="_5-安全模式"><a href="#_5-安全模式" class="header-anchor">#</a> 5.安全模式</h4> <ul><li>HDFS搭建时会格式化，格式化操作会产生一个空的FsImage</li> <li>当NameNode启动时，它从硬盘中读取EditLog和FsImage</li> <li>将所有EditLog中的事务作用在内存中的FsImage上</li> <li>并将这个新版本的FsImage从内存中保存到本地磁盘上</li> <li>然后删除旧的EditLog，因为这个旧的EditLog的事务都已经作用在FsImage上了</li> <li>NameNode启动后会进入一个称为安全模式的特殊状态</li> <li>处于安全模式的NameNode是不会进行数据块的复制的</li> <li>NameNode从所有的DataNode接收心跳信号和状态报告</li> <li>每当NameNode检测确认某个数据块的副本数目达到这个最小值，那么该数据块就会被认为时副本安全的（safely replicated）</li> <li>在一定百分比（可配）的数据块被NameNode检测确认是安全之后（加上一个额外的30秒等待时间），NameNode将退出安全模式状态</li> <li>接下来它会确定还有那些数据块的副本没有到达指定数目，并将这些数据块复制到其他DataNode上</li></ul> <blockquote><p>​     NameNode存元数据，文件属性、每个块在哪个DataNode上。在持久化的时候，文件属性会持久化，但是文件的每一个块不会持久化，恢复的时候，NameNode会丢失块的位置信息，需要等DataNode与NameNode建立心跳，汇报块的信息。</p></blockquote> <h4 id="_6-hdfs中的snn-secondarynamenode"><a href="#_6-hdfs中的snn-secondarynamenode" class="header-anchor">#</a> 6.HDFS中的SNN（SecondaryNameNode）</h4> <img src="/post-ci/img/bigdata/SNN.jpg" alt="SNN"> <ul><li>在非Ha模式下（非高可用，即只有一个NameNode，企业一般不会用这种模式，NameNode一旦挂掉，整个服务就会下线），SNN一般是独立的节点，周期完成对NameNode的EditLog向FsImage合并，减少EditLog大小，减少SNN启动时间</li> <li>根据配置文件设置的时间间隔fs.checkpoint.period 默认是3600秒</li> <li>根据配置文件设置的edits log大小 fs.checkpoint.size 规定edits文件的最大值默认是64MB</li></ul> <h4 id="_7-block的副本放置策略"><a href="#_7-block的副本放置策略" class="header-anchor">#</a> 7.Block的副本放置策略</h4> <ul><li>第一个副本：放置在上传文件的DataNode；如果是集群外提交，则随机挑选一台磁盘不太满，CPU不太忙的节点。</li> <li>第二个副本：放置在与第一个副本不同的机架的节点上。</li> <li>第三个副本：与第二个副本相同机架的节点（在同一个交换机下，降低成本）。</li> <li>更多副本：随机节点。（机架即机房放置服务器的架子，同一个机架上的服务器有自己的交换机和ups电源）</li></ul> <h4 id="_8-hdfs读写流程"><a href="#_8-hdfs读写流程" class="header-anchor">#</a> 8.HDFS读写流程</h4> <img src="/post-ci/img/bigdata/HDFS写流程.jpg" alt="HDFS写流程"> <h5 id="写流程"><a href="#写流程" class="header-anchor">#</a> 写流程</h5> <ul><li>Client和NameNode连接创建文件元数据</li> <li>NameNode判定元数据是否有效</li> <li>NameNode处发副本放置策略，返回一个有序的DataNode列表</li> <li>Client和DataNode建立Pipeline连接</li> <li>Client将块切分成packet（64kb），并使用chunk（512b）+chunksum（4b）填充</li> <li>Client将packet放入发送队列dataqueue中，并向第一个DataNode发送</li> <li>第一个DataNode收到packet后本地保存并发送给第二个DataNode</li> <li>第二个DataNode收到packet后本地保存并发送给第三个DataNode</li> <li>这一个过程中，上游节点同时发送下一个packet（生活中类比工厂的流水线，结论：流式其实也是变种的并行计算）</li> <li>HDFS使用这种传输方式，副本数对于Client是透明的</li> <li>当block传输完成，DataNode们各自向NameNode汇报，同时Client继续传输下一个block</li> <li>所以，Client的传输和block的汇报也是并行的</li></ul> <img src="/post-ci/img/bigdata/HDFS读流程.jpg" alt="HDFS读流程"> <h5 id="读流程"><a href="#读流程" class="header-anchor">#</a> 读流程</h5> <ul><li>为了降低整体的带宽消耗和读取延时，HDFS会尽量让读取程序读取离它最近的副本</li> <li>如果在读取程序的同一个机架上有一个副本，那么就读取该副本</li> <li>如果一个HDFS集群跨越多个数据中心，那么客户端也将首先读取本地的数据中心的副本</li> <li>语义：下载一个文件：
<ul><li>Client与NameNode交互文件元数据获取fileBlockLocation</li> <li>NameNode会按距离策略排序返回</li> <li>Client尝试下载block并校验数据完整性</li></ul></li> <li>语义：下载一个文件其实是获取文件的所有block元数据，那么子集获取某些block应该成立
<ul><li>HDFS支持Client给出文件的offset自定义连接哪些block的DataNode，自定义获取数据</li> <li>这个是支持计算层的分治，并行计算的核心</li></ul></li></ul> <h2 id="_6-数据湖"><a href="#_6-数据湖" class="header-anchor">#</a> 6.数据湖</h2> <p>数据湖就是集中式的数据存储库，可以存储各自数据格式数据，例如：非机构化数据、结构化数据、文本、视频......（待续）</p></div></article> <section class="post-meta main-div" data-v-4e23451f><section class="post-date clearfix" data-v-4e23451f><span class="create-date" data-v-4e23451f>
      发布时间 : 2022-05-02
    </span> <span class="update-date" data-v-4e23451f>
      最后修改 : 2022-12-08
    </span></section> <section class="post-links" data-v-4e23451f><a href="/post-ci/posts/2022/05/02/java-collection.html" class="post-link" data-v-4e23451f>
      上一篇 : Java容器集合
    </a> <a href="/post-ci/posts/2022/05/10/springcloud-component.html" class="post-link" data-v-4e23451f>
      下一篇 : springcloud各个组件
    </a></section></section> <div id="post-comments" class="main-div"><!----></div></div></main> <aside class="aside" data-v-4dd605a1><div class="info-card main-div" data-v-9d847660 data-v-4dd605a1><div class="info-card-header" style="background-size:cover;background-repeat:no-repeat;background-position:center;background-attachment:scroll;background-image:url(http://img.icoisini.xyz/wx-background.jpg);" data-v-9d847660><img src="http://img.icoisini.xyz/cm.jpg" alt="小二哥" class="info-avatar" data-v-9d847660></div> <div class="info-card-body" data-v-9d847660><section class="info-nickname" data-v-9d847660>
      小二哥
    </section> <section class="info-desc" data-v-9d847660>Don`t Worry Be Happy!</section> <section class="info-contact" data-v-9d847660><section data-v-9d847660><span title="DaLian City, China" data-v-9d847660 data-v-9d847660><svg class="icon" style="font-size:1em;" data-v-9d847660 data-v-9d847660><title data-v-9d847660 data-v-9d847660>DaLian City, China</title><use xlink:href="#icon-location" data-v-9d847660 data-v-9d847660></use></svg><span class="info-text" data-v-9d847660 data-v-9d847660>
          DaLian City, China
        </span></span></section> <section data-v-9d847660><span title="DaLian University of Technology" data-v-9d847660 data-v-9d847660><svg class="icon" style="font-size:1em;" data-v-9d847660 data-v-9d847660><title data-v-9d847660 data-v-9d847660>DaLian University of Technology</title><use xlink:href="#icon-organization" data-v-9d847660 data-v-9d847660></use></svg><span class="info-text" data-v-9d847660 data-v-9d847660>
          DaLian University of Technology
        </span></span></section> <section data-v-9d847660><a href="mailto:csrsming@163.com" title="csrsming@163.com" data-v-9d847660 data-v-9d847660><svg class="icon" style="font-size:1em;" data-v-9d847660 data-v-9d847660><title data-v-9d847660 data-v-9d847660>csrsming@163.com</title><use xlink:href="#icon-email" data-v-9d847660 data-v-9d847660></use></svg><span class="info-text" data-v-9d847660 data-v-9d847660>
          csrsming@163.com
        </span></a></section></section></div> <div class="info-card-footer" data-v-9d847660><section class="info-sns clearfix" data-v-9d847660><a href="https://github.com/csrsm" target="_blank" class="sns-link" data-v-9d847660><span title="GitHub: csrsm" class="sns-icon" data-v-9d847660 data-v-9d847660><svg class="icon" style="font-size:1.5em;" data-v-9d847660 data-v-9d847660><title data-v-9d847660 data-v-9d847660>GitHub: csrsm</title><use xlink:href="#icon-github" data-v-9d847660 data-v-9d847660></use></svg></span></a></section></div></div> <div class="post-nav-card main-div" style="position:relative;top:0;width:0px;" data-v-4dd605a1><div class="post-nav-contents"><svg class="icon"><title>book</title><use xlink:href="#icon-book"></use></svg> <span>文章目录</span> <div class="post-nav-toc"><ul><li><a href="/post-ci/posts/2022/05/02/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%9F%BA%E7%A1%80.html#_1-数据仓库分层">1.数据仓库分层</a></li><li><a href="/post-ci/posts/2022/05/02/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%9F%BA%E7%A1%80.html#_2-数据库-oltp与数据仓库的区别-olap">2.数据库-OLTP与数据仓库的区别-OLAP</a></li><li><a href="/post-ci/posts/2022/05/02/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%9F%BA%E7%A1%80.html#_3-大数据技术栈">3.大数据技术栈</a><ul><li><a href="/post-ci/posts/2022/05/02/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%9F%BA%E7%A1%80.html#_1-架构底层核心技术">1.架构底层核心技术：</a></li><li><a href="/post-ci/posts/2022/05/02/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%9F%BA%E7%A1%80.html#_2-数据采集体系技术">2.数据采集体系技术</a></li><li><a href="/post-ci/posts/2022/05/02/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%9F%BA%E7%A1%80.html#_3-中间件技术栈">3.中间件技术栈</a></li><li><a href="/post-ci/posts/2022/05/02/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%9F%BA%E7%A1%80.html#_4-分布式存储">4.分布式存储</a></li><li><a href="/post-ci/posts/2022/05/02/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%9F%BA%E7%A1%80.html#_5-数据处理技术">5.数据处理技术</a></li><li><a href="/post-ci/posts/2022/05/02/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%9F%BA%E7%A1%80.html#_6-olap生态系统">6.OLAP生态系统</a></li><li><a href="/post-ci/posts/2022/05/02/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%9F%BA%E7%A1%80.html#_7-稳健架构设计">7.稳健架构设计</a></li><li><a href="/post-ci/posts/2022/05/02/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%9F%BA%E7%A1%80.html#_8-集群调度体系">8.集群调度体系</a></li><li><a href="/post-ci/posts/2022/05/02/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%9F%BA%E7%A1%80.html#_9-数据挖掘体系相关">9.数据挖掘体系相关</a></li></ul></li><li><a href="/post-ci/posts/2022/05/02/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%9F%BA%E7%A1%80.html#_4-大数据架构演变">4.大数据架构演变</a><ul><li><a href="/post-ci/posts/2022/05/02/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%9F%BA%E7%A1%80.html#_1-lambda架构-离线处理-实时链路">1.Lambda架构（离线处理+实时链路）</a></li><li><a href="/post-ci/posts/2022/05/02/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%9F%BA%E7%A1%80.html#_2-lambda架构-离线数仓-实时数仓">2.Lambda架构（离线数仓+实时数仓）</a></li><li><a href="/post-ci/posts/2022/05/02/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%9F%BA%E7%A1%80.html#_3-kappa架构">3.Kappa架构</a></li><li><a href="/post-ci/posts/2022/05/02/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%9F%BA%E7%A1%80.html#_4-架构选择">4.架构选择</a></li><li><a href="/post-ci/posts/2022/05/02/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%9F%BA%E7%A1%80.html#_5-湖仓一体实时数据架构">5.湖仓一体实时数据架构</a></li></ul></li><li><a href="/post-ci/posts/2022/05/02/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%9F%BA%E7%A1%80.html#_5-hadoop">5.Hadoop</a><ul><li><a href="/post-ci/posts/2022/05/02/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%9F%BA%E7%A1%80.html#_1-hdfs">1.HDFS</a></li></ul></li><li><a href="/post-ci/posts/2022/05/02/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%9F%BA%E7%A1%80.html#_6-数据湖">6.数据湖</a></li></ul></div></div> <div class="post-nav-comments"><svg class="icon"><title>comment</title><use xlink:href="#icon-comment"></use></svg> <a href="/post-ci/posts/2022/05/02/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%9F%BA%E7%A1%80.html#post-comments">
      评论
    </a></div></div></aside></div> <footer class="footer" data-v-1375e54c><p class="footer-sns-links" data-v-1375e54c><a href="https://github.com/csrsm" target="_blank" class="sns-link" data-v-1375e54c><span title="GitHub: csrsm" class="sns-icon" data-v-1375e54c data-v-1375e54c><svg class="icon" style="font-size:25px;" data-v-1375e54c data-v-1375e54c><title data-v-1375e54c data-v-1375e54c>GitHub: csrsm</title><use xlink:href="#icon-github" data-v-1375e54c data-v-1375e54c></use></svg></span></a></p> <!----> <p class="footer-text" data-v-1375e54c>Copyright 2016-present <a href="https://github.com/csrsm" target="_blank">csrsm</a></p></footer></div><div class="global-ui"><!----><!----></div></div>
    <script src="/post-ci/assets/js/app.bf965bf3.js" defer></script><script src="/post-ci/assets/js/7.8eaaf042.js" defer></script><script src="/post-ci/assets/js/17.d4868fcd.js" defer></script>
  </body>
</html>
