<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>系统线上问题排查 | Csrsm</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/post-ci/img/favicon.ico">
    <meta name="description" content="This is my blog">
    <link rel="preload" href="/post-ci/assets/css/0.styles.0012e2a3.css" as="style"><link rel="preload" href="/post-ci/assets/js/app.9fa9c911.js" as="script"><link rel="preload" href="/post-ci/assets/js/7.8eaaf042.js" as="script"><link rel="preload" href="/post-ci/assets/js/28.33d7a492.js" as="script"><link rel="prefetch" href="/post-ci/assets/js/1.2e718cca.js"><link rel="prefetch" href="/post-ci/assets/js/10.503da5e1.js"><link rel="prefetch" href="/post-ci/assets/js/11.9d2fdfae.js"><link rel="prefetch" href="/post-ci/assets/js/12.fcb21a1d.js"><link rel="prefetch" href="/post-ci/assets/js/13.96503fd7.js"><link rel="prefetch" href="/post-ci/assets/js/14.20d93468.js"><link rel="prefetch" href="/post-ci/assets/js/15.52498f95.js"><link rel="prefetch" href="/post-ci/assets/js/16.56d46764.js"><link rel="prefetch" href="/post-ci/assets/js/17.ad79235f.js"><link rel="prefetch" href="/post-ci/assets/js/18.0505af28.js"><link rel="prefetch" href="/post-ci/assets/js/19.70092390.js"><link rel="prefetch" href="/post-ci/assets/js/20.e393cae7.js"><link rel="prefetch" href="/post-ci/assets/js/21.0973e7c3.js"><link rel="prefetch" href="/post-ci/assets/js/22.3329f709.js"><link rel="prefetch" href="/post-ci/assets/js/23.1c2d7d48.js"><link rel="prefetch" href="/post-ci/assets/js/24.2bbbae87.js"><link rel="prefetch" href="/post-ci/assets/js/25.e7489311.js"><link rel="prefetch" href="/post-ci/assets/js/26.db28cb94.js"><link rel="prefetch" href="/post-ci/assets/js/27.e2ce2855.js"><link rel="prefetch" href="/post-ci/assets/js/29.512128c3.js"><link rel="prefetch" href="/post-ci/assets/js/3.ff189134.js"><link rel="prefetch" href="/post-ci/assets/js/30.5336d253.js"><link rel="prefetch" href="/post-ci/assets/js/31.87b9a222.js"><link rel="prefetch" href="/post-ci/assets/js/32.28b31f24.js"><link rel="prefetch" href="/post-ci/assets/js/33.0145afad.js"><link rel="prefetch" href="/post-ci/assets/js/34.14093b0d.js"><link rel="prefetch" href="/post-ci/assets/js/35.28255673.js"><link rel="prefetch" href="/post-ci/assets/js/36.ab339a1d.js"><link rel="prefetch" href="/post-ci/assets/js/37.bb5c491b.js"><link rel="prefetch" href="/post-ci/assets/js/38.7afe4939.js"><link rel="prefetch" href="/post-ci/assets/js/39.3e12d1b7.js"><link rel="prefetch" href="/post-ci/assets/js/4.326ff035.js"><link rel="prefetch" href="/post-ci/assets/js/40.54529a63.js"><link rel="prefetch" href="/post-ci/assets/js/41.334e3703.js"><link rel="prefetch" href="/post-ci/assets/js/42.ed222455.js"><link rel="prefetch" href="/post-ci/assets/js/43.4d67dcce.js"><link rel="prefetch" href="/post-ci/assets/js/44.00297179.js"><link rel="prefetch" href="/post-ci/assets/js/45.352ae01d.js"><link rel="prefetch" href="/post-ci/assets/js/46.cb21b345.js"><link rel="prefetch" href="/post-ci/assets/js/47.d35f6d84.js"><link rel="prefetch" href="/post-ci/assets/js/48.1a48866e.js"><link rel="prefetch" href="/post-ci/assets/js/49.5d627a0e.js"><link rel="prefetch" href="/post-ci/assets/js/5.f96cd824.js"><link rel="prefetch" href="/post-ci/assets/js/50.fab4ccc6.js"><link rel="prefetch" href="/post-ci/assets/js/51.a1f72564.js"><link rel="prefetch" href="/post-ci/assets/js/52.552235e2.js"><link rel="prefetch" href="/post-ci/assets/js/53.c379a7a7.js"><link rel="prefetch" href="/post-ci/assets/js/54.1688b701.js"><link rel="prefetch" href="/post-ci/assets/js/55.c84919a4.js"><link rel="prefetch" href="/post-ci/assets/js/56.2add60cb.js"><link rel="prefetch" href="/post-ci/assets/js/57.1b744927.js"><link rel="prefetch" href="/post-ci/assets/js/58.2dc28d7b.js"><link rel="prefetch" href="/post-ci/assets/js/59.ab20e190.js"><link rel="prefetch" href="/post-ci/assets/js/6.562b2ef1.js"><link rel="prefetch" href="/post-ci/assets/js/8.40f58b51.js"><link rel="prefetch" href="/post-ci/assets/js/9.c8fcfbba.js">
    <link rel="stylesheet" href="/post-ci/assets/css/0.styles.0012e2a3.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="vuepress-theme-meteorlxy"><header class="header" style="background-size:cover;background-repeat:no-repeat;background-position:center;background-attachment:scroll;background-image:url(/img/0012.png);" data-v-7a046aea><div data-v-e4145d0a data-v-7a046aea><nav class="navbar" data-v-e4145d0a><div class="container" data-v-e4145d0a><a href="/post-ci/" class="router-link-active" data-v-e4145d0a><span class="navbar-site-name" data-v-e4145d0a>
          Csrsm
        </span></a> <div class="navbar-toggler" data-v-e4145d0a><svg class="icon" style="font-size:1.2em;" data-v-e4145d0a data-v-e4145d0a><title data-v-e4145d0a data-v-e4145d0a>menu</title><use xlink:href="#icon-menu" data-v-e4145d0a data-v-e4145d0a></use></svg></div> <div class="navbar-links" data-v-e4145d0a><a href="/post-ci/" class="navbar-link" data-v-e4145d0a>
            首页
          </a><a href="/post-ci/posts/" class="navbar-link router-link-active" data-v-e4145d0a>
            Csrsm
          </a></div></div></nav> <div class="navbar-holder" style="display:none;" data-v-e4145d0a></div></div> <div class="banner" data-v-98d6aa8c data-v-7a046aea data-v-7a046aea><div class="container" data-v-98d6aa8c><div class="center" data-v-98d6aa8c><h1 data-v-98d6aa8c data-v-7a046aea>
          系统线上问题排查
        </h1></div></div></div></header> <div class="container clearfix show-aside" data-v-4dd605a1 data-v-4dd605a1><main class="main" data-v-4dd605a1><div class="post" data-v-4dd605a1 data-v-4dd605a1><section class="post-meta main-div" data-v-4e23451f><section class="post-date clearfix" data-v-4e23451f><span class="create-date" data-v-4e23451f>
      发布时间 : 2023-04-01
    </span> <span class="update-date" data-v-4e23451f>
      最后修改 : 2024-11-22
    </span></section> <section class="post-links" data-v-4e23451f><a href="/post-ci/posts/2023/02/13/helm%E5%91%BD%E4%BB%A4.html" class="post-link" data-v-4e23451f>
      上一篇 : Helm命令
    </a> <a href="/post-ci/posts/2019/01/21/hello-world.html" class="post-link" data-v-4e23451f>
      下一篇 : Hello, world!
    </a></section></section> <article class="main-div"><div class="post-content content content__default"><h1 id="线上问题事故分析"><a href="#线上问题事故分析" class="header-anchor">#</a> 线上问题事故分析</h1> <h2 id="背景"><a href="#背景" class="header-anchor">#</a> 背景</h2> <p>3月31日下午部分经销商反应dms系统页面出现卡顿问题，根据反映情况，可以确认是clue-service服务接口调用响应超时，经排查发现，具体出现问题的时间节点是31日下午2点整左右。</p> <h2 id="_1-全局服务监控分析"><a href="#_1-全局服务监控分析" class="header-anchor">#</a> <strong>1.全局服务监控分析</strong></h2> <p>通过应用监控TSF发现，clue-service服务的整体并发情况的没有明显的提升，但是服务的平均响应耗时以及错误率却有明显的提升，故排除掉并发量增加导致的系统卡顿的情况。可以发现在14:00左右时，响应耗时骤升导致错误率上升。具体情况如下：</p> <table><thead><tr><th><strong>13:50 至 13:57</strong></th> <th><strong>13:57 至 14:03</strong></th></tr></thead> <tbody><tr><td>请求量：35113次</td> <td>请求量：31162次</td></tr> <tr><td>吞吐量：73.15qps</td> <td>吞吐量：74.2qps</td></tr> <tr><td>平均响应耗时：225ms</td> <td>平均响应耗时：2420ms</td></tr> <tr><td><img src="/post-ci/img/issue/问题排查1.png"></td> <td><img src="/post-ci/img/issue/问题排查2.png"></td></tr> <tr><td><img src="/post-ci/img/issue/问题排查3.png"></td> <td><img src="/post-ci/img/issue/问题排查4.png"></td></tr> <tr><td><img src="/post-ci/img/issue/问题排查5.png"></td> <td><img src="/post-ci/img/issue/问题排查6.png"></td></tr></tbody></table> <h2 id="_2-拓扑分析"><a href="#_2-拓扑分析" class="header-anchor">#</a> <strong>2.拓扑分析</strong></h2> <p>通过调用关系分析发现，在下游调用服务中，存储服务如mysql、redis服务的平均响应时间并没有明显的提升，而f4push、yxywzt-lead-center.faw.cn以及dmscloud.faw.cn服务的响应时间具有明显的增长，具体对比如下：</p> <table><thead><tr><th><strong>13:50 至 13:57</strong></th> <th><strong>13:57 至 14:03</strong></th></tr></thead> <tbody><tr><td><img src="/post-ci/img/issue/问题排查7.png"></td> <td><img src="/post-ci/img/issue/问题排查8.png"></td></tr></tbody></table> <p>具体查看这三个服务的接口调用，通过对比发现三个服务的接口调用数量较少，不会导致整个服务的响应时间以及错误率骤升，故排除下游服务调用问题。具体如下：</p> <table><thead><tr><th><strong>13:50 至 13:57</strong></th> <th><strong>13:57 至 14:03</strong></th></tr></thead> <tbody><tr><td>f4push</td> <td></td></tr> <tr><td><img src="/post-ci/img/issue/问题排查9.png"></td> <td><img src="/post-ci/img/issue/问题排查10.png"></td></tr> <tr><td>yxywzt-lead-center.faw.cn</td> <td></td></tr> <tr><td><img src="/post-ci/img/issue/问题排查11.png"></td> <td><img src="/post-ci/img/issue/问题排查12.png"></td></tr> <tr><td>dmscloud.faw.cn</td> <td></td></tr> <tr><td><img src="/post-ci/img/issue/问题排查13.png"></td> <td><img src="/post-ci/img/issue/问题排查14.png"></td></tr></tbody></table> <p>对比调用mysql、redis的调用情况，发现mysql的请求量并没有太大的变化，而其中慢sql查询的响应时间也没有明显的变化，故排除由于mysql查询导致的系统卡顿的情况。而redis的请求量和响应时间也没有明显的变化，所有可以排除由于redis查询导致的系统卡顿的情况。</p> <table><thead><tr><th><strong>13:50 至 13:57</strong></th> <th><strong>13:57 至 14:03</strong></th></tr></thead> <tbody><tr><td>mysql</td> <td></td></tr> <tr><td><img src="/post-ci/img/issue/问题排查15.png"></td> <td><img src="/post-ci/img/issue/问题排查16.png"></td></tr> <tr><td>redis</td> <td></td></tr> <tr><td><img src="/post-ci/img/issue/问题排查17.png"></td> <td><img src="/post-ci/img/issue/问题排查18.png"></td></tr></tbody></table> <h2 id="_3-服务实例问题排查"><a href="#_3-服务实例问题排查" class="header-anchor">#</a> <strong>3.服务实例问题排查</strong></h2> <p>通过排查clue-service服务在13:50-13:57与13:57-14:03两个时间段的对比发现，此服务的其中一个实例（clue-service-79d677cdb6-2t5mc）在请求量下降的情况下，响应时间由1028毫秒骤升至25436毫秒，具体对比如下图：</p> <table><thead><tr><th><strong>13:50 至 13:57</strong></th> <th><strong>13:57 至 14:03</strong></th></tr></thead> <tbody><tr><td><img src="/post-ci/img/issue/问题排查19.png"></td> <td><img src="/post-ci/img/issue/问题排查20.png"></td></tr> <tr><td><img src="/post-ci/img/issue/问题排查21.png"></td> <td><img src="/post-ci/img/issue/问题排查22.png"></td></tr></tbody></table> <p>通过查看其他时间段的实例对比，发现此实例的平均响应时间远高于其他实例（平均10倍左右）。故推测反馈问题的经销商请求可能是由当前实例处理，从而导致页面卡顿，影响用户体验。</p> <p>在确定是此实例导致的系统卡顿问题后，发现TSF监控不能查看节点的内存及cpu的使用情况，而K8s事件监控只能查看近一小时的日志，所以没有办法进行进一步的排查。</p> <img src="/post-ci/img/issue/问题排查23.png"> <h2 id="_4-结论及建议"><a href="#_4-结论及建议" class="header-anchor">#</a> <strong>4.结论及建议</strong></h2> <h3 id="结论"><a href="#结论" class="header-anchor">#</a> <strong>结论：</strong></h3> <p>clue-service的其中一个实例出现问题，但由于TSF没有采集实例的内存、cpu使用情况以及k8s时间监控不支持历史查询，所以无法进一步排查问题。</p> <h3 id="建议"><a href="#建议" class="header-anchor">#</a> <strong>建议：</strong></h3> <p>建议将停用此实例并备份，重新创建一个实例，并与此实例不在同一个物理机上，进一步对比观察。</p> <h2 id="_5-总结"><a href="#_5-总结" class="header-anchor">#</a> 5.总结</h2> <p>排查思路</p> <ul><li>整体服务监控，排查出现问题的时间节点，是否有功能上线，排除新功能上线影响系统</li> <li>整体服务监控发现的问题时间节点前后TPS是否骤升，判断是否是由于并发导致的问题</li> <li>查看拓扑关系，检查问题节点时间前后的上下游调用是否存在差异，包括下游应用服务以及下游存储服务
<ul><li>如果下游存储服务的rt大幅度增加（平均响应时间），查看数据库监控，是否存在慢sql、死锁等情况，涉及的表是否是频繁调用的接口中所使用的数据表，此种情况需要优化sql以及业务逻辑</li> <li>如果下游应用服务的rt大幅度增加，则需要进一步排查下游应用是否有新功能上线导致的问题</li></ul></li> <li>排查服务实例是否存在问题，服务实例存在问题则需要具体查看实例的虚拟机内存、cpu、jvm等方面确定问题原因</li></ul></div></article> <section class="post-meta main-div" data-v-4e23451f><section class="post-date clearfix" data-v-4e23451f><span class="create-date" data-v-4e23451f>
      发布时间 : 2023-04-01
    </span> <span class="update-date" data-v-4e23451f>
      最后修改 : 2024-11-22
    </span></section> <section class="post-links" data-v-4e23451f><a href="/post-ci/posts/2023/02/13/helm%E5%91%BD%E4%BB%A4.html" class="post-link" data-v-4e23451f>
      上一篇 : Helm命令
    </a> <a href="/post-ci/posts/2019/01/21/hello-world.html" class="post-link" data-v-4e23451f>
      下一篇 : Hello, world!
    </a></section></section> <div id="post-comments" class="main-div"><!----></div></div></main> <aside class="aside" data-v-4dd605a1><div class="info-card main-div" data-v-9d847660 data-v-4dd605a1><div class="info-card-header" style="background-size:cover;background-repeat:no-repeat;background-position:center;background-attachment:scroll;background-image:url(/img/wx-background.jpg);" data-v-9d847660><img src="/img/cm.jpg" alt="小二哥" class="info-avatar" data-v-9d847660></div> <div class="info-card-body" data-v-9d847660><section class="info-nickname" data-v-9d847660>
      小二哥
    </section> <section class="info-desc" data-v-9d847660>Don`t Worry Be Happy!</section> <section class="info-contact" data-v-9d847660><section data-v-9d847660><span title="DaLian City, China" data-v-9d847660 data-v-9d847660><svg class="icon" style="font-size:1em;" data-v-9d847660 data-v-9d847660><title data-v-9d847660 data-v-9d847660>DaLian City, China</title><use xlink:href="#icon-location" data-v-9d847660 data-v-9d847660></use></svg><span class="info-text" data-v-9d847660 data-v-9d847660>
          DaLian City, China
        </span></span></section> <section data-v-9d847660><span title="DaLian University of Technology" data-v-9d847660 data-v-9d847660><svg class="icon" style="font-size:1em;" data-v-9d847660 data-v-9d847660><title data-v-9d847660 data-v-9d847660>DaLian University of Technology</title><use xlink:href="#icon-organization" data-v-9d847660 data-v-9d847660></use></svg><span class="info-text" data-v-9d847660 data-v-9d847660>
          DaLian University of Technology
        </span></span></section> <section data-v-9d847660><a href="mailto:csrsming@163.com" title="csrsming@163.com" data-v-9d847660 data-v-9d847660><svg class="icon" style="font-size:1em;" data-v-9d847660 data-v-9d847660><title data-v-9d847660 data-v-9d847660>csrsming@163.com</title><use xlink:href="#icon-email" data-v-9d847660 data-v-9d847660></use></svg><span class="info-text" data-v-9d847660 data-v-9d847660>
          csrsming@163.com
        </span></a></section></section></div> <div class="info-card-footer" data-v-9d847660><section class="info-sns clearfix" data-v-9d847660><a href="https://github.com/csrsm" target="_blank" class="sns-link" data-v-9d847660><span title="GitHub: csrsm" class="sns-icon" data-v-9d847660 data-v-9d847660><svg class="icon" style="font-size:1.5em;" data-v-9d847660 data-v-9d847660><title data-v-9d847660 data-v-9d847660>GitHub: csrsm</title><use xlink:href="#icon-github" data-v-9d847660 data-v-9d847660></use></svg></span></a></section></div></div> <div class="post-nav-card main-div" style="position:relative;top:0;width:0px;" data-v-4dd605a1><div class="post-nav-contents"><svg class="icon"><title>book</title><use xlink:href="#icon-book"></use></svg> <span>文章目录</span> <div class="post-nav-toc"><ul><li><a href="/post-ci/posts/2023/04/01/%E8%AE%B0%E4%B8%80%E6%AC%A1%E7%BA%BF%E4%B8%8A%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5.html#背景">背景</a></li><li><a href="/post-ci/posts/2023/04/01/%E8%AE%B0%E4%B8%80%E6%AC%A1%E7%BA%BF%E4%B8%8A%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5.html#_1-全局服务监控分析">1.全局服务监控分析</a></li><li><a href="/post-ci/posts/2023/04/01/%E8%AE%B0%E4%B8%80%E6%AC%A1%E7%BA%BF%E4%B8%8A%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5.html#_2-拓扑分析">2.拓扑分析</a></li><li><a href="/post-ci/posts/2023/04/01/%E8%AE%B0%E4%B8%80%E6%AC%A1%E7%BA%BF%E4%B8%8A%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5.html#_3-服务实例问题排查">3.服务实例问题排查</a></li><li><a href="/post-ci/posts/2023/04/01/%E8%AE%B0%E4%B8%80%E6%AC%A1%E7%BA%BF%E4%B8%8A%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5.html#_4-结论及建议">4.结论及建议</a><ul><li><a href="/post-ci/posts/2023/04/01/%E8%AE%B0%E4%B8%80%E6%AC%A1%E7%BA%BF%E4%B8%8A%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5.html#结论">结论：</a></li><li><a href="/post-ci/posts/2023/04/01/%E8%AE%B0%E4%B8%80%E6%AC%A1%E7%BA%BF%E4%B8%8A%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5.html#建议">建议：</a></li></ul></li><li><a href="/post-ci/posts/2023/04/01/%E8%AE%B0%E4%B8%80%E6%AC%A1%E7%BA%BF%E4%B8%8A%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5.html#_5-总结">5.总结</a></li></ul></div></div> <div class="post-nav-comments"><svg class="icon"><title>comment</title><use xlink:href="#icon-comment"></use></svg> <a href="/post-ci/posts/2023/04/01/%E8%AE%B0%E4%B8%80%E6%AC%A1%E7%BA%BF%E4%B8%8A%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5.html#post-comments">
      评论
    </a></div></div></aside></div> <footer class="footer" data-v-1375e54c><p class="footer-sns-links" data-v-1375e54c><a href="https://github.com/csrsm" target="_blank" class="sns-link" data-v-1375e54c><span title="GitHub: csrsm" class="sns-icon" data-v-1375e54c data-v-1375e54c><svg class="icon" style="font-size:25px;" data-v-1375e54c data-v-1375e54c><title data-v-1375e54c data-v-1375e54c>GitHub: csrsm</title><use xlink:href="#icon-github" data-v-1375e54c data-v-1375e54c></use></svg></span></a></p> <!----> <p class="footer-text" data-v-1375e54c>Copyright 2016-present <a href="https://github.com/csrsm" target="_blank">csrsm</a></p></footer></div><div class="global-ui"><!----><!----></div></div>
    <script src="/post-ci/assets/js/app.9fa9c911.js" defer></script><script src="/post-ci/assets/js/7.8eaaf042.js" defer></script><script src="/post-ci/assets/js/28.33d7a492.js" defer></script>
  </body>
</html>
